"use strict";function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value;}catch(error){reject(error);return;}if(info.done){resolve(value);}else{return Promise.resolve(value).then(function(value){return step("next",value);},function(err){return step("throw",err);});}}return step("next");});};}var advanceStateController=function advanceStateController($scope,advanceService,toaster,$state,$uibModal,$translate,Authentication){return new Promise(function(resolve,reject){var _this=this;try{/** TODO ------------------------- Data List --------------------------------------------------- **/$scope.mainAdvanceForm={};$scope.data={clipboardFolder:null,showClipboardFolder:false,clipboardFolderPushed:false,PropertyGroupParent:null,selectMetadataParent:null,metadataParent:null,isSearched:false,metaAndKeywordSet:false,selectOneKeywordAndMetaData:false,showComplate:true,removeExternalFuncs:{},removeExternalCSS:{},showType:null,sort:{type:null,ascDesc:true},store:{input:null,selectedStore:null},stores:[],news:{input:null,selectedNews:null},newes:[],rangs:[5,10,25],list:[],total:-1,filters:{},state:'advance',profile:null,scrollOption:{cursorcolor:"#5d9ce9",cursorwidth:"3px",cursorborderradius:"0px",railalign:'right',horizrailenabled:false,railpadding:{top:0,right:3,left:0,bottom:0}},isOpen:{to:false,from:false},open:function open($event,type){_.forEach($scope.data.isOpen,function(value,key){return $scope.data.isOpen[key]=false;});$event.preventDefault();$event.stopPropagation();$scope.data.isOpen[type]=true;},advanceOBJ:{mainAdvance:null,offset:0,range:5,categoryPushed:false,categories:{},contentPushed:false,content:null,keywordPushed:false,keyword:null,notePushed:false,note:null,path:null,author:null,date:{from:null,to:null},systematicPath:null,documentType:null,file:0,folder:0,email:0,docName:null},nav:{right:{selectedSide:null,isOpened:false,select:function select(selectedSide,id){if($scope.data.nav.right.selectedSide!=null&&$scope.data.nav.right.selectedSide!=selectedSide){try{window.document.querySelector(".D div."+$scope.data.nav.right.selectedSide).classList.remove("show");}catch(e){console.error(e);}}try{window.document.querySelector(".D div."+selectedSide).classList.add("show");}catch(e){console.error(e);}finally{if($scope.data.nav.right.selectedSide==null||$scope.data.nav.right.selectedSide!=selectedSide){$scope.data.nav.right.selectedSide=selectedSide;$scope.data.nav.right.isOpened=$scope.data.nav.right.isOpened||true;if(typeof $scope.func[selectedSide]!=="undefiend"&&_.isFunction($scope.func[selectedSide]))$scope.func[selectedSide](id);}}}},left:{selectedSide:null,isOpened:false,select:function select(selectedSide,keyNoteCotent){$scope.data.nav.left.selectedSide=keyNoteCotent?keyNoteCotent:selectedSide;$scope.data.nav.left.isOpened=$scope.data.nav.left.isOpened||true;}}},metadatas:null,selectMetadata:null,metadata:null,systematicPaths:[],documentTypes:[],domainLookUp:{file:'سند',folder:'پوشه',email:'پست الکترونیکی'},itemsPagination:{totalItems:-1,currentPage:1,maxSize:5,show:false,searchTerm:"",pageChanged:function pageChanged(){$scope.data.advanceOBJ.limit=$scope.data.advanceOBJ.range;$scope.func.search((parseInt($scope.data.itemsPagination.currentPage)-1)*$scope.data.advanceOBJ.range);}},showFormGeneratorButtons:false,showTable:true,showRelations:false,relationsPushed:false,relationStorage:null,relations:null,showSelectedResult:false,selectedResultPushed:false,selectedResultStorage:null,selectedResults:null,isItemInClipboard:false,showClipBoardResults:false,selectedClipBoardStorage:null,clipBoardResultPushed:false};/** TODO ------------------------- Function List ----------------------------------------------- **/$scope.func={};/** TODO --------------------------------------------------- clipboards  ------------------------**/$scope.func.hiddenClipboardResultList=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:$scope.data.showClipBoardResults=false;if(!($scope.data.selectedClipBoardStorage==null)){_context.next=13;break;}_context.prev=2;_context.next=5;return removeSelectedLocalStorage('clipBoardResults');case 5:$scope.data.isItemInClipboard=false;_context.next=11;break;case 8:_context.prev=8;_context.t0=_context["catch"](2);console.error(_context.t0);case 11:_context.next=21;break;case 13:_context.prev=13;_context.next=16;return setSelectedLocalStorage(_.clone($scope.data.selectedClipBoardStorage),'clipBoardResults');case 16:_context.next=21;break;case 18:_context.prev=18;_context.t1=_context["catch"](13);console.error(_context.t1);case 21:_.defer(function(){return $scope.$apply();});case 22:case"end":return _context.stop();}}},_callee,_this,[[2,8],[13,18]]);}));$scope.func.pinToClipboardResult=function(){try{$scope.data.clipBoardResultPushed=!$scope.data.clipBoardResultPushed;try{$("#clipboardResultViewer").draggable($scope.data.clipBoardResultPushed?'disable':'enable');}catch(e){console.error(e);}_.defer(function(){return $scope.$apply();});}catch(e){console.error(e);}};$scope.func.removeClipboardResult=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){return regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;if($scope.data.selectedClipBoardStorage!=null&&!_.isEqual($scope.data.selectedClipBoardStorage,{})){$scope.data.selectedClipBoardStorage=null;$scope.data.isItemInClipboard=false;$scope.func.hiddenClipboardResultList();}else toaster.pop('error','','شما رابطه ای برای حذف کردن ندارید.');_context2.next=9;break;case 4:_context2.prev=4;_context2.t0=_context2["catch"](0);console.error(_context2.t0);_context2.next=9;return JSManagement.removeJS("ecma5/ExternalLiberary/Desktop/deleteRelation.js?dev="+randomVersionName,'deleteRelationDesktopCtrl');case 9:_context2.prev=9;$scope.data.isItemInClipboard=!_.isEqual($scope.data.selectedClipBoardStorage,{})&&$scope.data.selectedClipBoardStorage!=null;_.defer(function(){return $scope.$apply();});return _context2.finish(9);case 13:case"end":return _context2.stop();}}},_callee2,_this,[[0,4,9,13]]);}));$scope.func.removeClipboardResultItem=function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(id){var type;return regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;if(!($scope.data.selectedClipBoardStorage!=null)){_context3.next=31;break;}_context3.prev=2;if(!_.has($scope.data.selectedClipBoardStorage,id)){_context3.next=23;break;}$scope.data.selectedClipBoardStorage[id]=undefined;delete $scope.data.selectedClipBoardStorage[id];type=angular.copy($scope.data.selectedClipBoardStorage.TYPE);$scope.data.selectedClipBoardStorage.TYPE=undefined;delete $scope.data.selectedClipBoardStorage.TYPE;if(!_.isEqual($scope.data.selectedClipBoardStorage,{})){_context3.next=14;break;}$scope.data.selectedClipBoardStorage=null;$scope.func.hiddenClipboardResultList();_context3.next=23;break;case 14:_context3.prev=14;$scope.data.selectedClipBoardStorage.TYPE=type;_context3.next=18;return setSelectedLocalStorage(_.clone($scope.data.selectedClipBoardStorage),'clipBoardResults');case 18:_context3.next=23;break;case 20:_context3.prev=20;_context3.t0=_context3["catch"](14);console.error(_context3.t0);case 23:_context3.next=28;break;case 25:_context3.prev=25;_context3.t1=_context3["catch"](2);console.error(_context3.t1);case 28:_context3.prev=28;_.defer(function(){return $scope.$apply();});return _context3.finish(28);case 31:_context3.next=36;break;case 33:_context3.prev=33;_context3.t2=_context3["catch"](0);console.error(_context3.t2);case 36:case"end":return _context3.stop();}}},_callee3,_this,[[0,33],[2,25,28,31],[14,20]]);}));return function(_x){return _ref3.apply(this,arguments);};}();$scope.func.removeAllClipboards=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(){return regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:try{$scope.data.selectedClipBoardStorage=null;$scope.func.hiddenClipboardResultList();}catch(e){console.error(e);}case 1:case"end":return _context4.stop();}}},_callee4,_this);}));$scope.func.addToClipBoardResults=function(){var _ref5=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(item,type){var selectedResults;return regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.prev=0;_context5.prev=1;_context5.next=4;return getSelectedLocalStorage('clipBoardResults');case 4:selectedResults=_context5.sent;if(selectedResults==null)selectedResults={};selectedResults['TYPE']=type;if(_.has(selectedResults,item.uuid))toaster.pop('info','','این آیتم قبلا به لیست انتخابی اضافه شده است.');else{selectedResults[item.uuid]=_.clone(item);$scope.data.selectedClipBoardStorage=_.clone(selectedResults);toaster.pop('success','','آیتم با موفقیت به لیست موقت افزوده شد.');}_context5.prev=8;_context5.next=11;return setSelectedLocalStorage(_.clone(selectedResults),'clipBoardResults');case 11:_context5.next=16;break;case 13:_context5.prev=13;_context5.t0=_context5["catch"](8);console.error(_context5.t0);case 16:selectedResults=undefined;$scope.data.isItemInClipboard=!_.isEqual($scope.data.selectedClipBoardStorage,{})&&$scope.data.selectedClipBoardStorage!=null;_context5.next=23;break;case 20:_context5.prev=20;_context5.t1=_context5["catch"](1);console.error(_context5.t1);case 23:_context5.prev=23;_.defer(function(){return $scope.$apply();});return _context5.finish(23);case 26:_context5.next=31;break;case 28:_context5.prev=28;_context5.t2=_context5["catch"](0);console.error(_context5.t2);case 31:case"end":return _context5.stop();}}},_callee5,_this,[[0,28],[1,20,23,26],[8,13]]);}));return function(_x2,_x3){return _ref5.apply(this,arguments);};}();$scope.func.showClipBoardResultsList=_asyncToGenerator(regeneratorRuntime.mark(function _callee6(){return regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:if(!($scope.data.selectedClipBoardStorage==null)){_context6.next=12;break;}_context6.prev=1;_context6.next=4;return getSelectedLocalStorage('clipBoardResults');case 4:$scope.data.selectedClipBoardStorage=_context6.sent;if($scope.data.selectedClipBoardStorage==null)$scope.data.selectedClipBoardStorage={};_context6.next=12;break;case 8:_context6.prev=8;_context6.t0=_context6["catch"](1);console.error(_context6.t0);return _context6.abrupt("return");case 12:$scope.data.showClipBoardResults=true;$scope.data.isItemInClipboard=!_.isEqual($scope.data.selectedClipBoardStorage,{})&&$scope.data.selectedClipBoardStorage!=null;try{$("#clipboardResultViewer").draggable({"axis":"x","containment":"body"});}catch(e){console.error(e);}_.defer(function(){return $scope.$apply();});case 16:case"end":return _context6.stop();}}},_callee6,_this,[[1,8]]);}));/** TODO --------------------------------------------------- search navigations  ----------------**/$scope.func.copySearch=function(){var _ref7=_asyncToGenerator(regeneratorRuntime.mark(function _callee7(sendItem){var item;return regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:_context7.prev=0;item=angular.copy(sendItem);if(_.has(item,'thumbnailSrc')){_context7.next=18;break;}if(!_.has(item,'type')){_context7.next=18;break;}_context7.t0=item.type;_context7.next=_context7.t0==='document'?7:_context7.t0==='folder'?15:18;break;case 7:_context7.next=9;return JSManagement.addJS("ecma5/ExternalLiberary/Public/getSrcFromType.js?dev="+randomVersionName);case 9:$scope.data.removeExternalFuncs["ecma5/ExternalLiberary/Public/getSrcFromType.js?dev="+randomVersionName]='getSrcFromType';_context7.next=12;return $scope.func.getImageLocal(item);case 12:item.thumbnailSrc=_context7.sent;item.name=item.name;return _context7.abrupt("break",18);case 15:item.thumbnailSrc="../../../../static/image/folder"+(item.hasChildren?'s':'')+".png";item.name=item.name;return _context7.abrupt("break",18);case 18:$scope.func.addToClipBoardResults(item,'COPY');_context7.next=24;break;case 21:_context7.prev=21;_context7.t1=_context7["catch"](0);console.error(_context7.t1);case 24:case"end":return _context7.stop();}}},_callee7,_this,[[0,21]]);}));return function(_x4){return _ref7.apply(this,arguments);};}();$scope.func.cutSearch=function(){var _ref8=_asyncToGenerator(regeneratorRuntime.mark(function _callee8(sendItem){var item;return regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:_context8.prev=0;item=angular.copy(sendItem);if(_.has(item,'thumbnailSrc')){_context8.next=18;break;}if(!_.has(item,'type')){_context8.next=18;break;}_context8.t0=item.type;_context8.next=_context8.t0==='document'?7:_context8.t0==='folder'?15:18;break;case 7:_context8.next=9;return JSManagement.addJS("ecma5/ExternalLiberary/Public/getSrcFromType.js?dev="+randomVersionName);case 9:$scope.data.removeExternalFuncs["ecma5/ExternalLiberary/Public/getSrcFromType.js?dev="+randomVersionName]='getSrcFromType';_context8.next=12;return $scope.func.getImageLocal(item);case 12:item.thumbnailSrc=_context8.sent;item.name=item.name;return _context8.abrupt("break",18);case 15:item.thumbnailSrc="../../../../static/image/folder"+(item.hasChildren?'s':'')+".png";item.name=item.name;return _context8.abrupt("break",18);case 18:$scope.func.addToClipBoardResults(item,'CUT');_context8.next=24;break;case 21:_context8.prev=21;_context8.t1=_context8["catch"](0);console.error(_context8.t1);case 24:case"end":return _context8.stop();}}},_callee8,_this,[[0,21]]);}));return function(_x5){return _ref8.apply(this,arguments);};}();$scope.func.removeSearch=function(){var _ref9=_asyncToGenerator(regeneratorRuntime.mark(function _callee9(item){return regeneratorRuntime.wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:_context9.prev=0;$scope.func.advanceRemoveSearch();_context9.next=22;break;case 4:_context9.prev=4;_context9.t0=_context9["catch"](0);console.error(_context9.t0);_context9.prev=7;_context9.next=10;return JSManagement.addJS("ecma5/ExternalLiberary/Search/insideController/functions/advanceRemoveSearch.js?dev="+randomVersionName);case 10:$scope.data.removeExternalFuncs["ecma5/ExternalLiberary/Search/insideController/functions/advanceRemoveSearch.js?dev="+randomVersionName]="advanceRemoveSearchAdvanceCtrl";_context9.next=13;return advanceRemoveSearchAdvanceCtrl($scope,advanceService,JSManagement,CSSManagement,toaster,$uibModal,$translate);case 13:$scope.func.advanceRemoveSearch();_context9.next=19;break;case 16:_context9.prev=16;_context9.t1=_context9["catch"](7);console.error(_context9.t1);case 19:_context9.prev=19;_.defer(function(){return $scope.$apply();});return _context9.finish(19);case 22:case"end":return _context9.stop();}}},_callee9,_this,[[0,4],[7,16,19,22]]);}));return function(_x6){return _ref9.apply(this,arguments);};}();$scope.func.downloadSearch=function(){var _ref10=_asyncToGenerator(regeneratorRuntime.mark(function _callee10(item){var isDownload;return regeneratorRuntime.wrap(function _callee10$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:_context10.prev=0;_context10.next=3;return JSManagement.addJS("ecma5/ExternalLiberary/Public/getPermisionArray.js?dev="+randomVersionName);case 3:$scope.data.removeExternalFuncs["ecma5/ExternalLiberary/Public/getPermisionArray.js?dev="+randomVersionName]='getPermisionArray';isDownload=getPermisionArray(item.permissions);if(!(item.type=="folder")){_context10.next=19;break;}if(!isDownload[2]){_context10.next=16;break;}_context10.next=9;return JSManagement.addJS("ecma5/ExternalLiberary/Public/convertTozipFolderFunction.js?dev="+randomVersionName);case 9:$scope.data.removeExternalFuncs["ecma5/ExternalLiberary/Public/convertTozipFolderFunction.js?dev="+randomVersionName]='convertTozipFolderFunction';$("#show-waiting-get-rest-from-server-id").addClass('show-waiting');_context10.next=13;return convertTozipFolderFunction(item);case 13:$("#show-waiting-get-rest-from-server-id").removeClass('show-waiting');_context10.next=17;break;case 16:toaster.pop('warning',""," امکان دریافت پوشه "+item.name+" وجود ندارد. ");case 17:_context10.next=27;break;case 19:if(!isDownload[2]){_context10.next=26;break;}_context10.next=22;return JSManagement.addJS("ecma5/ExternalLiberary/Public/downloadFileFunction.js?dev="+randomVersionName);case 22:$scope.data.removeExternalFuncs["ecma5/ExternalLiberary/Public/downloadFileFunction.js?dev="+randomVersionName]='downloadFileFunction';downloadFileFunction(item);_context10.next=27;break;case 26:toaster.pop('warning',""," امکان دریافت سند"+item.name+" وجود ندارد. ");case 27:_context10.next=34;break;case 29:_context10.prev=29;_context10.t0=_context10["catch"](0);console.error(_context10.t0);$("#show-waiting-get-rest-from-server-id").removeClass('show-waiting');toaster.pop('warning',"","مشکلی در دریافت به وجود آمده است.");case 34:case"end":return _context10.stop();}}},_callee10,_this,[[0,29]]);}));return function(_x7){return _ref10.apply(this,arguments);};}();$scope.func.addCategoriesSearch=function(){var _ref11=_asyncToGenerator(regeneratorRuntime.mark(function _callee11(item){var isCategories,response;return regeneratorRuntime.wrap(function _callee11$(_context11){while(1){switch(_context11.prev=_context11.next){case 0:_context11.prev=0;_context11.next=3;return JSManagement.addJS("ecma5/ExternalLiberary/Public/getPermisionArray.js?dev="+randomVersionName);case 3:$scope.data.removeExternalFuncs["ecma5/ExternalLiberary/Public/getPermisionArray.js?dev="+randomVersionName]='getPermisionArray';isCategories=getPermisionArray(item.permissions);if(!isCategories[2]){_context11.next=21;break;}_context11.next=8;return JSManagement.addJS("ecma5/ExternalLiberary/Desktop/addCategories2DesktopCtrl.js?dev="+randomVersionName);case 8:$scope.data.removeExternalFuncs["ecma5/ExternalLiberary/Desktop/addCategories2DesktopCtrl.js?dev="+randomVersionName]='addCategories2DesktopCtrl';_context11.next=11;return addCategories2DesktopCtrl($uibModal,//modal func
advanceService.repository,//repository service
'getCategoriesFolder',// rootPath
advanceService.folder// folder service
);case 11:response=_context11.sent;_context11.prev=12;_context11.next=15;return advanceService.property.addCategory(item.uuid,response.addNode.id);case 15:toaster.pop('success','','دسته بندی با موفقیت افزوده شد.');_context11.next=21;break;case 18:_context11.prev=18;_context11.t0=_context11["catch"](12);toaster.pop('warning',""," امکان افزودن به دسته بندی "+item.name+" وجود ندارد ");case 21:toaster.pop('warning',"","شما مجوز لازم جهت انجام این کار را ندارید.");_context11.next=28;break;case 24:_context11.prev=24;_context11.t1=_context11["catch"](0);console.error(_context11.t1);toaster.pop('warning',""," امکان افزودن به دسته بندی "+item.name+" وجود ندارد ");case 28:case"end":return _context11.stop();}}},_callee11,_this,[[0,24],[12,18]]);}));return function(_x8){return _ref11.apply(this,arguments);};}();$scope.func.addWorkFlowSearch=function(){var _ref12=_asyncToGenerator(regeneratorRuntime.mark(function _callee12(item){var isRelation;return regeneratorRuntime.wrap(function _callee12$(_context12){while(1){switch(_context12.prev=_context12.next){case 0:_context12.prev=0;_context12.next=3;return JSManagement.addJS("ecma5/ExternalLiberary/Public/getPermisionArray.js?dev="+randomVersionName);case 3:$scope.data.removeExternalFuncs["ecma5/ExternalLiberary/Public/getPermisionArray.js?dev="+randomVersionName]='getPermisionArray';isRelation=getPermisionArray(item.permissions);if(!isRelation[2]){_context12.next=15;break;}_context12.next=8;return JSManagement.addJS("ecma5/ExternalLiberary/Desktop/addWorkFlowCtrl.js?dev="+randomVersionName);case 8:_context12.next=10;return addWorkFlowCtrl($uibModal,item,advanceService);case 10:_context12.next=12;return JSManagement.removeJS("ecma5/ExternalLiberary/Desktop/addWorkFlowCtrl.js?dev="+randomVersionName,'addWorkFlowCtrl');case 12:toaster.pop('success',"","گردش کار با موفقیت افزوده شد");_context12.next=16;break;case 15:toaster.pop('warning',""," امکان افزودن گردش کار برای آیتم "+item.name+" نیست ");case 16:_context12.next=21;break;case 18:_context12.prev=18;_context12.t0=_context12["catch"](0);toaster.pop('warning',""," مشکلی در افزودن گردش کار برای آیتم "+item.name+" به وجود آمده است. ");case 21:case"end":return _context12.stop();}}},_callee12,_this,[[0,18]]);}));return function(_x9){return _ref12.apply(this,arguments);};}();$scope.func.addTemplatesSearch=function(){var _ref13=_asyncToGenerator(regeneratorRuntime.mark(function _callee13(item){return regeneratorRuntime.wrap(function _callee13$(_context13){while(1){switch(_context13.prev=_context13.next){case 0:_context13.prev=0;$scope.func.advanceAddTemplatesSearch(item);_context13.next=21;break;case 4:_context13.prev=4;_context13.t0=_context13["catch"](0);_context13.prev=6;_context13.next=9;return JSManagement.addJS("ecma5/ExternalLiberary/Search/insideController/functions/advanceAddTemplatesSearch.js?dev="+randomVersionName);case 9:$scope.data.removeExternalFuncs["ecma5/ExternalLiberary/Search/insideController/functions/advanceAddTemplatesSearch.js?dev="+randomVersionName]="advanceAddTemplatesSearchAdvanceCtrl";_context13.next=12;return advanceGenerateTableAdvanceCtrl($scope,advanceService,JSManagement,CSSManagement,toaster,$uibModal,$translate);case 12:$scope.func.advanceAddTemplatesSearch(item);_context13.next=18;break;case 15:_context13.prev=15;_context13.t1=_context13["catch"](6);console.error(_context13.t1);case 18:_context13.prev=18;_.defer(function(){return $scope.$apply();});return _context13.finish(18);case 21:case"end":return _context13.stop();}}},_callee13,_this,[[0,4],[6,15,18,21]]);}));return function(_x10){return _ref13.apply(this,arguments);};}();$scope.func.saveClipbBoardtems=function(){var _ref14=_asyncToGenerator(regeneratorRuntime.mark(function _callee14(item){return regeneratorRuntime.wrap(function _callee14$(_context14){while(1){switch(_context14.prev=_context14.next){case 0:_context14.prev=0;$scope.func.advancesaveClipbBoardtems(item);_context14.next=22;break;case 4:_context14.prev=4;_context14.t0=_context14["catch"](0);console.error(_context14.t0);_context14.prev=7;_context14.next=10;return JSManagement.addJS("ecma5/ExternalLiberary/Search/insideController/functions/advancesaveClipbBoardtems.js?dev="+randomVersionName);case 10:$scope.data.removeExternalFuncs["ecma5/ExternalLiberary/Search/insideController/functions/advancesaveClipbBoardtems.js?dev="+randomVersionName]="advancesaveClipbBoardtemsAdvanceCtrl";_context14.next=13;return advancesaveClipbBoardtemsAdvanceCtrl($scope,advanceService,JSManagement,CSSManagement,toaster,$uibModal,$translate);case 13:$scope.func.advancesaveClipbBoardtems(item);_context14.next=19;break;case 16:_context14.prev=16;_context14.t1=_context14["catch"](7);console.error(_context14.t1);case 19:_context14.prev=19;_.defer(function(){return $scope.$apply();});return _context14.finish(19);case 22:case"end":return _context14.stop();}}},_callee14,_this,[[0,4],[7,16,19,22]]);}));return function(_x11){return _ref14.apply(this,arguments);};}();/** TODO ------------------------- Erase Search Results ---------------------------------------- **/$scope.func.erase=_asyncToGenerator(regeneratorRuntime.mark(function _callee15(){return regeneratorRuntime.wrap(function _callee15$(_context15){while(1){switch(_context15.prev=_context15.next){case 0:_context15.prev=0;$scope.func.advanceErase();_context15.next=21;break;case 4:_context15.prev=4;_context15.t0=_context15["catch"](0);_context15.prev=6;_context15.next=9;return JSManagement.addJS("ecma5/ExternalLiberary/Search/insideController/functions/advanceErase.js?dev="+randomVersionName);case 9:$scope.data.removeExternalFuncs["ecma5/ExternalLiberary/Search/insideController/functions/advanceErase.js?dev="+randomVersionName]="advanceEraseAdvanceCtrl";_context15.next=12;return advanceEraseAdvanceCtrl($scope,advanceService,JSManagement,CSSManagement,toaster,$uibModal,$translate);case 12:$scope.func.advanceErase();_context15.next=18;break;case 15:_context15.prev=15;_context15.t1=_context15["catch"](6);console.error(_context15.t1);case 18:_context15.prev=18;_.defer(function(){return $scope.$apply();});return _context15.finish(18);case 21:case"end":return _context15.stop();}}},_callee15,_this,[[0,4],[6,15,18,21]]);}));$scope.func.removeComplateAdvance=function(){return new Promise(function(resolve,reject){try{$scope.data.advanceOBJ={mainAdvance:null,offset:0,range:5,contentPushed:false,content:null,keywordPushed:false,keyword:null,notePushed:false,note:null,path:null,author:null,date:{from:null,to:null},systematicPath:null,documentType:null,file:0,folder:0,email:0,docName:null};$scope.data.filters={};$scope.data.metaAndKeywordSet=false;$scope.data.selectOneKeywordAndMetaData=false;$scope.data.selectMetadata=null;if(_.isFunction($scope.externalScope.InitializationForm))$scope.externalScope.InitializationForm(null,{});$scope.data.list=[];$scope.data.total=-1;$scope.data.isSearched=false;$scope.data.showTable=true;_.defer(function(){$scope.$apply();resolve(true);});}catch(e){reject(false);}});};/** TODO ------------------------- dragable Parent Metadata  functions ------------------------- **/$scope.func.hiddenSaved2Clipboard=function(){$scope.data.showClipboardFolder=false;_.defer(function(){return $scope.$apply();});};$scope.func.showSaved2Clipboard=_asyncToGenerator(regeneratorRuntime.mark(function _callee16(){return regeneratorRuntime.wrap(function _callee16$(_context16){while(1){switch(_context16.prev=_context16.next){case 0:_context16.prev=0;$scope.func.advanceShowSaved2Clipboard();_context16.next=21;break;case 4:_context16.prev=4;_context16.t0=_context16["catch"](0);_context16.prev=6;_context16.next=9;return JSManagement.addJS("ecma5/ExternalLiberary/Search/insideController/functions/advanceShowSaved2Clipboard.js?dev="+randomVersionName);case 9:$scope.data.removeExternalFuncs["ecma5/ExternalLiberary/Search/insideController/functions/advanceShowSaved2Clipboard.js?dev="+randomVersionName]="advanceShowSaved2ClipboardAdvanceCtrl";_context16.next=12;return advanceShowSaved2ClipboardAdvanceCtrl($scope,advanceService,JSManagement,CSSManagement,toaster,$uibModal,$translate);case 12:$scope.func.advanceShowSaved2Clipboard();_context16.next=18;break;case 15:_context16.prev=15;_context16.t1=_context16["catch"](6);console.error(_context16.t1);case 18:_context16.prev=18;_.defer(function(){return $scope.$apply();});return _context16.finish(18);case 21:case"end":return _context16.stop();}}},_callee16,_this,[[0,4],[6,15,18,21]]);}));$scope.func.removeSaved2Clipboard=_asyncToGenerator(regeneratorRuntime.mark(function _callee17(){return regeneratorRuntime.wrap(function _callee17$(_context17){while(1){switch(_context17.prev=_context17.next){case 0:_context17.prev=0;_context17.prev=1;_context17.next=4;return removeSelectedLocalStorage('selectedMetadataState');case 4:$scope.data.clipboardFolder=null;$scope.data.showClipboardFolder=false;$scope.data.PropertyGroupParent=null;_context17.next=12;break;case 9:_context17.prev=9;_context17.t0=_context17["catch"](1);console.error(_context17.t0);case 12:toaster.pop('success','','فراداده با موفقیت از حافظه موقت حذف گردید');_.defer(function(){return $scope.$apply();});_context17.next=19;break;case 16:_context17.prev=16;_context17.t1=_context17["catch"](0);console.error(_context17.t1);case 19:case"end":return _context17.stop();}}},_callee17,_this,[[0,16],[1,9]]);}));$scope.func.pinToLocation=function(){try{$scope.data.clipboardFolderPushed=!$scope.data.clipboardFolderPushed;try{$("#clipBoardMetaDataSaved").draggable($scope.data.clipboardFolderPushed?'disable':'enable');}catch(e){console.error(e);}_.defer(function(){return $scope.$apply();});}catch(e){console.error(e);}};$scope.func.showedMetadata=function(){$scope.data.showTable=!$scope.data.showTable;_.defer(function(){return $scope.$apply($scope.func.search(0));});};/**TODO ------------------------- News Search --------------------------------------------------- **/$scope.func.removeStoreNews=function(){var _ref18=_asyncToGenerator(regeneratorRuntime.mark(function _callee18(news,index){var response;return regeneratorRuntime.wrap(function _callee18$(_context18){while(1){switch(_context18.prev=_context18.next){case 0:_context18.prev=0;_context18.next=3;return JSManagement.addJS("ecma5/ExternalLiberary/Public/deleteRequest.js?dev="+randomVersionName);case 3:$scope.data.removeExternalFuncs["ecma5/ExternalLiberary/Public/deleteRequest.js?dev="+randomVersionName]='deleteRequestCtrl';_context18.next=6;return deleteRequestCtrl($uibModal);case 6:response=_context18.sent;if(response){advanceService.search.remove(news.id).then(function(res){if($scope.data.news.selectedNews!=null&&$scope.data.news.selectedNews.id==news.id){$scope.data.news.selectedNews=null;$scope.data.news.input=null;}$scope.data.newes.splice(index,1);toaster.pop('success','','خبر با  موفقیت حذف گردید');},function(error){return toaster.pop('error','','امکان حذف خبر وجود ندارد');});}_context18.next=13;break;case 10:_context18.prev=10;_context18.t0=_context18["catch"](0);console.error(_context18.t0);case 13:case"end":return _context18.stop();}}},_callee18,_this,[[0,10]]);}));return function(_x12,_x13){return _ref18.apply(this,arguments);};}();$scope.func.searchStoreNews=function(news){try{$scope.data.news.selectedNews=null;$scope.data.news.input=null;$scope.func.selectStoreNews(news,true);}catch(e){console.error(e);}};$scope.func.selectStoreNews=function(){var _ref19=_asyncToGenerator(regeneratorRuntime.mark(function _callee19(news,isSearch){return regeneratorRuntime.wrap(function _callee19$(_context19){while(1){switch(_context19.prev=_context19.next){case 0:_context19.prev=0;if(!($scope.data.news.selectedNews!=null&&$scope.data.news.selectedNews.id==news.id)){_context19.next=6;break;}$scope.data.news.selectedNews=null;$scope.data.news.input=null;_context19.next=13;break;case 6:$scope.data.news.selectedNews=_.clone(news);$scope.data.news.input=_.clone(news.queryName);_context19.next=10;return $scope.func.removeComplateAdvance();case 10:_context19.next=12;return $scope.func.fillItems(_.clone(news));case 12:if(typeof isSearch!=="undefined")$scope.func.search(0);case 13:_context19.next=18;break;case 15:_context19.prev=15;_context19.t0=_context19["catch"](0);console.error(_context19.t0);case 18:case"end":return _context19.stop();}}},_callee19,_this,[[0,15]]);}));return function(_x14,_x15){return _ref19.apply(this,arguments);};}();$scope.func.newsVisible=function(){var _ref20=_asyncToGenerator(regeneratorRuntime.mark(function _callee20(id){return regeneratorRuntime.wrap(function _callee20$(_context20){while(1){switch(_context20.prev=_context20.next){case 0:_context20.prev=0;if(!($scope.data.store.selectedStore!=null)){_context20.next=6;break;}$scope.data.store.selectedStore=null;$scope.data.store.input=null;_context20.next=6;return $scope.func.removeComplateAdvance();case 6:advanceService.dashboard.getList('getUserSearchs').then(function(response){if(response.data.originalElement!=null){////$scope.data.newes = _.clone(_.filter(response.data , res => res.dashboard == true));
$scope.data.newes=_.clone(response.data.originalElement);//TODO send id from /dashboard/news state to show for advance state
if(typeof id!=="undefined"){var index=_.findIndex($scope.data.newes,function(news){return news.id==id;});if(index>=0)$scope.func.selectStoreNews($scope.data.newes[index],true);}}else $scope.data.newes=[];_.defer(function(){return $scope.$apply();});},function(error){toaster.pop('error','',error);_.defer(function(){return $scope.$apply();});});_context20.next=12;break;case 9:_context20.prev=9;_context20.t0=_context20["catch"](0);console.error(_context20.t0);case 12:case"end":return _context20.stop();}}},_callee20,_this,[[0,9]]);}));return function(_x16){return _ref20.apply(this,arguments);};}();$scope.func.saveOrEditStoreNews=_asyncToGenerator(regeneratorRuntime.mark(function _callee22(){return regeneratorRuntime.wrap(function _callee22$(_context22){while(1){switch(_context22.prev=_context22.next){case 0:_context22.prev=0;if(_.includes([null,""],$scope.data.news.input)){_context22.next=5;break;}return _context22.delegateYield(regeneratorRuntime.mark(function _callee21(){var json,index;return regeneratorRuntime.wrap(function _callee21$(_context21){while(1){switch(_context21.prev=_context21.next){case 0:_context21.next=2;return JSManagement.addJS("ecma5/ExternalLiberary/Search/saveSearchGenerator.js?dev="+randomVersionName);case 2:$scope.data.removeExternalFuncs["ecma5/ExternalLiberary/Search/saveSearchGenerator.js?dev="+randomVersionName]='saveSearchGeneratorFunction';_context21.next=5;return saveSearchGeneratorFunction(_.clone($scope.data.filters),_.clone($scope.data.news.input));case 5:json=_context21.sent;// TODO from news type
json.queryParams.dashboard=1;if(!($scope.data.news.selectedNews!=null)){_context21.next=17;break;}json.queryParams.id=$scope.data.news.selectedNews.id;_context21.next=11;return advanceService.search.update(json);case 11:json.queryParams.properties=_.keyBy(_.map(json.queryParams.properties.entry,function(property){var p=property.value;p.key=property.key;return p;}),'key');index=_.findIndex($scope.data.newes,function(news){return news.id==json.queryParams.id;});if(index>=0){$scope.data.newes[index]=_.clone(json.queryParams);}_.defer(function(){return $scope.$apply();});_context21.next=18;break;case 17:advanceService.search.save(json).then(function(res){json.queryParams.id=res.data.data;json.queryParams.properties=_.keyBy(_.map(json.queryParams.properties.entry,function(property){var p=property.value;p.key=property.key;return p;}),'key');$scope.data.newes.push(_.clone(res.data.config.data.queryParams));$scope.func.selectStoreNews($scope.data.newes.slice(-1)[0],true);},function(error){return toaster.pop('error','','عدم ذخیره موفق نتیجه خبر');});case 18:case"end":return _context21.stop();}}},_callee21,_this);})(),"t0",3);case 3:_context22.next=6;break;case 5:toaster.pop('error','','لطفا برای نتیجه خبر عبارتی را انتخاب کنید');case 6:_context22.next=11;break;case 8:_context22.prev=8;_context22.t1=_context22["catch"](0);console.error(_context22.t1);case 11:case"end":return _context22.stop();}}},_callee22,_this,[[0,8]]);}));/**TODO ------------------------- Store Search -------------------------------------------------- **/$scope.func.removeStoreSearch=function(){var _ref22=_asyncToGenerator(regeneratorRuntime.mark(function _callee23(store,index){var response;return regeneratorRuntime.wrap(function _callee23$(_context23){while(1){switch(_context23.prev=_context23.next){case 0:_context23.prev=0;_context23.next=3;return JSManagement.addJS("ecma5/ExternalLiberary/Public/deleteRequest.js?dev="+randomVersionName);case 3:$scope.data.removeExternalFuncs["ecma5/ExternalLiberary/Public/deleteRequest.js?dev="+randomVersionName]='deleteRequestCtrl';_context23.next=6;return deleteRequestCtrl($uibModal);case 6:response=_context23.sent;if(response){advanceService.search.remove(store.id).then(function(res){if($scope.data.store.selectedStore!=null&&$scope.data.store.selectedStore.id==store.id){$scope.data.store.selectedStore=null;$scope.data.store.input=null;}$scope.data.stores.splice(index,1);toaster.pop('success','','جستجو با  موفقیت حذف گردید');},function(error){return toaster.pop('error','','امکان حذف جستجو وجود ندارد');});}_context23.next=13;break;case 10:_context23.prev=10;_context23.t0=_context23["catch"](0);console.error(_context23.t0);case 13:case"end":return _context23.stop();}}},_callee23,_this,[[0,10]]);}));return function(_x17,_x18){return _ref22.apply(this,arguments);};}();$scope.func.searchStoreSearch=function(store){try{$scope.data.store.selectedStore=null;$scope.data.store.input=null;$scope.func.selectStoreSearch(store,true);}catch(e){console.error(e);}};$scope.func.selectStoreSearch=function(){var _ref23=_asyncToGenerator(regeneratorRuntime.mark(function _callee24(store,isSearch){return regeneratorRuntime.wrap(function _callee24$(_context24){while(1){switch(_context24.prev=_context24.next){case 0:_context24.prev=0;if(!($scope.data.store.selectedStore!=null&&$scope.data.store.selectedStore.id==store.id)){_context24.next=6;break;}$scope.data.store.selectedStore=null;$scope.data.store.input=null;_context24.next=13;break;case 6:$scope.data.store.selectedStore=_.clone(store);$scope.data.store.input=_.clone(store.queryName);_context24.next=10;return $scope.func.removeComplateAdvance();case 10:_context24.next=12;return $scope.func.fillItems(_.clone(store));case 12:if(typeof isSearch!=="undefined")$scope.func.search(0);case 13:_context24.next=18;break;case 15:_context24.prev=15;_context24.t0=_context24["catch"](0);console.error(_context24.t0);case 18:case"end":return _context24.stop();}}},_callee24,_this,[[0,15]]);}));return function(_x19,_x20){return _ref23.apply(this,arguments);};}();$scope.func.storeVisible=_asyncToGenerator(regeneratorRuntime.mark(function _callee25(){return regeneratorRuntime.wrap(function _callee25$(_context25){while(1){switch(_context25.prev=_context25.next){case 0:_context25.prev=0;if(!($scope.data.store.selectedNews!=null)){_context25.next=6;break;}$scope.data.store.selectedNews=null;$scope.data.news.input=null;_context25.next=6;return $scope.func.removeComplateAdvance();case 6:advanceService.search.list().then(function(response){$scope.data.stores=response.data!=null?_.clone(response.data):[];_.defer(function(){return $scope.$apply();});},function(error){toaster.pop('error','',error);});_context25.next=12;break;case 9:_context25.prev=9;_context25.t0=_context25["catch"](0);console.error(_context25.t0);case 12:case"end":return _context25.stop();}}},_callee25,_this,[[0,9]]);}));$scope.func.saveOrEditStoreSearch=_asyncToGenerator(regeneratorRuntime.mark(function _callee27(){return regeneratorRuntime.wrap(function _callee27$(_context27){while(1){switch(_context27.prev=_context27.next){case 0:_context27.prev=0;if(_.includes([null,""],$scope.data.store.input)){_context27.next=5;break;}return _context27.delegateYield(regeneratorRuntime.mark(function _callee26(){var json,index;return regeneratorRuntime.wrap(function _callee26$(_context26){while(1){switch(_context26.prev=_context26.next){case 0:_context26.next=2;return JSManagement.addJS("ecma5/ExternalLiberary/Search/saveSearchGenerator.js?dev="+randomVersionName);case 2:$scope.data.removeExternalFuncs["ecma5/ExternalLiberary/Search/saveSearchGenerator.js?dev="+randomVersionName]='saveSearchGeneratorFunction';_context26.next=5;return saveSearchGeneratorFunction(_.clone($scope.data.filters),_.clone($scope.data.store.input));case 5:json=_context26.sent;if(!($scope.data.store.selectedStore!=null)){_context26.next=16;break;}json.queryParams.id=$scope.data.store.selectedStore.id;_context26.next=10;return advanceService.search.update(json);case 10:json.queryParams.properties=_.keyBy(_.map(json.queryParams.properties.entry,function(property){var p=property.value;p.key=property.key;return p;}),'key');index=_.findIndex($scope.data.stores,function(store){return store.id==json.queryParams.id;});if(index>=0){$scope.data.stores[index]=_.clone(json.queryParams);}_.defer(function(){return $scope.$apply();});_context26.next=17;break;case 16:advanceService.search.save(json).then(function(res){json.queryParams.id=res.data.data;json.queryParams.properties=_.keyBy(_.map(json.queryParams.properties.entry,function(property){var p=property.value;p.key=property.key;return p;}),'key');$scope.data.stores.push(_.clone(res.data.config.data.queryParams));$scope.func.selectStoreSearch($scope.data.stores.slice(-1)[0],true);},function(error){return toaster.pop('error','','عدم ذخیره موفق نتیجه جستجو');});case 17:case"end":return _context26.stop();}}},_callee26,_this);})(),"t0",3);case 3:_context27.next=6;break;case 5:toaster.pop('error','','لطفا برای نتیجه جستجو عبارتی را انتخاب کنید');case 6:_context27.next=11;break;case 8:_context27.prev=8;_context27.t1=_context27["catch"](0);console.error(_context27.t1);case 11:case"end":return _context27.stop();}}},_callee27,_this,[[0,8]]);}));$scope.func.viewFile=function(){var _ref26=_asyncToGenerator(regeneratorRuntime.mark(function _callee28(doc){return regeneratorRuntime.wrap(function _callee28$(_context28){while(1){switch(_context28.prev=_context28.next){case 0:_context28.prev=0;$scope.func.advanceviewFile(doc);_context28.next=21;break;case 4:_context28.prev=4;_context28.t0=_context28["catch"](0);_context28.prev=6;_context28.next=9;return JSManagement.addJS("ecma5/ExternalLiberary/Search/insideController/functions/advanceviewFile.js?dev="+randomVersionName);case 9:$scope.data.removeExternalFuncs["ecma5/ExternalLiberary/Search/insideController/functions/advanceviewFile.js?dev="+randomVersionName]="advanceviewFileAdvanceCtrl";_context28.next=12;return advanceviewFileAdvanceCtrl($scope,advanceService,JSManagement,CSSManagement,toaster,$uibModal,$translate);case 12:$scope.func.advanceviewFile(doc);_context28.next=18;break;case 15:_context28.prev=15;_context28.t1=_context28["catch"](6);console.error(_context28.t1);case 18:_context28.prev=18;_.defer(function(){return $scope.$apply();});return _context28.finish(18);case 21:case"end":return _context28.stop();}}},_callee28,_this,[[0,4],[6,15,18,21]]);}));return function(_x21){return _ref26.apply(this,arguments);};}();$scope.func.go2Desktop=function(){var _ref27=_asyncToGenerator(regeneratorRuntime.mark(function _callee29(item,isMetaData){return regeneratorRuntime.wrap(function _callee29$(_context29){while(1){switch(_context29.prev=_context29.next){case 0:_context29.prev=0;if($scope.data.profile.prfStack.taxonomyVisible){_context29.next=3;break;}throw new Error("امکان ورود به این صفحه وجود ندارد .");case 3:_context29.next=5;return JSManagement.addJS("ecma5/ExternalLiberary/Public/saveChangeStateVar.js?dev="+randomVersionName);case 5:if(typeof isMetaData!=="undefined")item.isMetaData=isMetaData;_context29.next=8;return setStateVarFunction(item);case 8:$state.go('main.page.desktop',{},{reload:false});_context29.next=15;break;case 11:_context29.prev=11;_context29.t0=_context29["catch"](0);console.error(_context29.t0);toaster.pop("error","",_context29.t0.message);case 15:case"end":return _context29.stop();}}},_callee29,_this,[[0,11]]);}));return function(_x22,_x23){return _ref27.apply(this,arguments);};}();$scope.func.search=function(){var _ref28=_asyncToGenerator(regeneratorRuntime.mark(function _callee30(offset){return regeneratorRuntime.wrap(function _callee30$(_context30){while(1){switch(_context30.prev=_context30.next){case 0:_context30.prev=0;$scope.func.advanceSearch(offset);_context30.next=21;break;case 4:_context30.prev=4;_context30.t0=_context30["catch"](0);_context30.prev=6;_context30.next=9;return JSManagement.addJS("ecma5/ExternalLiberary/Search/insideController/functions/advanceSearch.js?dev="+randomVersionName);case 9:$scope.data.removeExternalFuncs["ecma5/ExternalLiberary/Search/insideController/functions/advanceSearch.js?dev="+randomVersionName]="advanceSearchAdvanceCtrl";_context30.next=12;return advanceSearchAdvanceCtrl($scope,advanceService,JSManagement,CSSManagement,toaster,$uibModal,$translate);case 12:$scope.func.advanceSearch(offset);_context30.next=18;break;case 15:_context30.prev=15;_context30.t1=_context30["catch"](6);console.error(_context30.t1);case 18:_context30.prev=18;_.defer(function(){return $scope.$apply();});return _context30.finish(18);case 21:case"end":return _context30.stop();}}},_callee30,_this,[[0,4],[6,15,18,21]]);}));return function(_x24){return _ref28.apply(this,arguments);};}();$scope.func.getImage=function(){var _ref29=_asyncToGenerator(regeneratorRuntime.mark(function _callee31(item){return regeneratorRuntime.wrap(function _callee31$(_context31){while(1){switch(_context31.prev=_context31.next){case 0:_context31.next=2;return JSManagement.addJS("ecma5/ExternalLiberary/Public/getSrcFromType.js?dev="+randomVersionName);case 2:$scope.data.removeExternalFuncs["ecma5/ExternalLiberary/Public/getSrcFromType.js?dev="+randomVersionName]='getSrcFromType';try{advanceService.document.thumbnail(item,0,75).then(function(result){item.thumbnailSrc="data:image/png;base64,"+result.data;_.defer(function(){return $scope.$apply();});},function(error){item.thumbnailSrc=getSrcFromType(item.mimeType);_.defer(function(){return $scope.$apply();});});}catch(e){console.error(e);}case 4:case"end":return _context31.stop();}}},_callee31,_this);}));return function(_x25){return _ref29.apply(this,arguments);};}();$scope.func.generateResult=function(){var _ref30=_asyncToGenerator(regeneratorRuntime.mark(function _callee32(data){return regeneratorRuntime.wrap(function _callee32$(_context32){while(1){switch(_context32.prev=_context32.next){case 0:_context32.prev=0;$scope.func.advanceGenerateResult(data);_context32.next=21;break;case 4:_context32.prev=4;_context32.t0=_context32["catch"](0);_context32.prev=6;_context32.next=9;return JSManagement.addJS("ecma5/ExternalLiberary/Search/insideController/functions/advanceGenerateResult.js?dev="+randomVersionName);case 9:$scope.data.removeExternalFuncs["ecma5/ExternalLiberary/Search/insideController/functions/advanceGenerateResult.js?dev="+randomVersionName]="advanceGenerateResultAdvanceCtrl";_context32.next=12;return advanceGenerateResultAdvanceCtrl($scope,advanceService,JSManagement,CSSManagement,toaster,$uibModal,$translate);case 12:$scope.func.advanceGenerateResult(data);_context32.next=18;break;case 15:_context32.prev=15;_context32.t1=_context32["catch"](6);console.error(_context32.t1);case 18:_context32.prev=18;_.defer(function(){return $scope.$apply();});return _context32.finish(18);case 21:case"end":return _context32.stop();}}},_callee32,_this,[[0,4],[6,15,18,21]]);}));return function(_x26){return _ref30.apply(this,arguments);};}();$scope.func.generateTable=function(){var _ref31=_asyncToGenerator(regeneratorRuntime.mark(function _callee33(res,metadata){return regeneratorRuntime.wrap(function _callee33$(_context33){while(1){switch(_context33.prev=_context33.next){case 0:_context33.prev=0;$scope.func.advanceGenerateTable(res,metadata);_context33.next=21;break;case 4:_context33.prev=4;_context33.t0=_context33["catch"](0);_context33.prev=6;_context33.next=9;return JSManagement.addJS("ecma5/ExternalLiberary/Search/insideController/functions/advanceGenerateTable.js?dev="+randomVersionName);case 9:$scope.data.removeExternalFuncs["ecma5/ExternalLiberary/Search/insideController/functions/advanceGenerateTable.js?dev="+randomVersionName]="advanceGenerateTableAdvanceCtrl";_context33.next=12;return advanceGenerateTableAdvanceCtrl($scope,advanceService,JSManagement,CSSManagement,toaster,$uibModal,$translate);case 12:$scope.func.advanceGenerateTable(res,metadata);_context33.next=18;break;case 15:_context33.prev=15;_context33.t1=_context33["catch"](6);console.error(_context33.t1);case 18:_context33.prev=18;_.defer(function(){return $scope.$apply();});return _context33.finish(18);case 21:case"end":return _context33.stop();}}},_callee33,_this,[[0,4],[6,15,18,21]]);}));return function(_x27,_x28){return _ref31.apply(this,arguments);};}();/**TODO ------------------------- CSV ----------------------------------------------------------- **/$scope.func.showCSV=_asyncToGenerator(regeneratorRuntime.mark(function _callee35(){var link;return regeneratorRuntime.wrap(function _callee35$(_context35){while(1){switch(_context35.prev=_context35.next){case 0:_context35.prev=0;if(!(isCookieFunction('Authorization')!=null)){_context35.next=5;break;}return _context35.delegateYield(regeneratorRuntime.mark(function _callee34(){var filters,query;return regeneratorRuntime.wrap(function _callee34$(_context34){while(1){switch(_context34.prev=_context34.next){case 0:filters={};_.forEach(_.filter($scope.data.filters,function(filter){return _.includes(["smetadata","propertyGroups"],filter.type);}),function(f){var key=_.first(_.split(f.key,'.'));filters[key]=key;});_context34.next=4;return JSManagement.addJS("ecma5/ExternalLiberary/Search/createQueryFromFilters.js?dev="+randomVersionName);case 4:$scope.data.removeExternalFuncs["ecma5/ExternalLiberary/Search/createQueryFromFilters.js?dev="+randomVersionName]='createQueryFromFilters,dateFormatInternalCreateQuery';_context34.next=7;return createQueryFromFilters(_.clone($scope.data.filters),// query objects
0,// offset
5// range
);case 7:query=_context34.sent;if($scope.data.selectOneKeywordAndMetaData)query+="&metaAndKeywordSet="+$scope.data.metaAndKeywordSet;query+="&authId="+decodeURIComponent(isCookieFunction("Authorization").replace('Bearer',''));if(query.endsWith("&"))query=query.slice(0,query.length-1);console.log(query);link=document.createElement("a");link.download='result.csv';link.href="/KeydocPro/services/rest/search/findAndGetCsv?"+query;link.style="visibility:hidden";link.name='key_downloadLink_result.csv';window.document.body.appendChild(link);link.click();window.document.body.removeChild(link);case 20:case"end":return _context34.stop();}}},_callee34,_this);})(),"t0",3);case 3:_context35.next=6;break;case 5:throw"لطفا ابتدا وارد سیستم شوید.";case 6:_context35.next=11;break;case 8:_context35.prev=8;_context35.t1=_context35["catch"](0);toaster.pop('error','','لطفا حداقل یک فیلتر درج کنید.');case 11:case"end":return _context35.stop();}}},_callee35,_this,[[0,8]]);}));/**TODO ------------------------- Sort search Table --------------------------------------------- **/$scope.func.orderBy=function(headerKey){try{$scope.data.sort.type=headerKey;$scope.data.sort.ascDesc=!$scope.data.sort.ascDesc;var ascOrDesc=$scope.data.sort.ascDesc?'asc':'desc';$scope.data.list=_.orderBy($scope.data.list,function(i){return i.list[headerKey].value;},ascOrDesc);}catch(e){console.error(e);}finally{_.defer(function(){return $scope.$apply();});}};$scope.func.domainChange=function(key){if($scope.data.advanceOBJ[key]==0){try{delete $scope.data.filters["systematic-domain-"+key+"-filter"];}catch(e){console.error(e);}}else $scope.data.filters["systematic-domain-"+key+"-filter"]={title:""+$scope.data.domainLookUp[key],value:_.clone(parseInt($scope.data.advanceOBJ[key])),type:"domain",pointer:$scope.data.advanceOBJ,bind:key,removeValue:0};_.defer(function(){return $scope.$apply();});};$scope.func.changeDate=function(){var _ref33=_asyncToGenerator(regeneratorRuntime.mark(function _callee36(type){var date;return regeneratorRuntime.wrap(function _callee36$(_context36){while(1){switch(_context36.prev=_context36.next){case 0:if(!_.isDate($scope.data.advanceOBJ.date[type])){_context36.next=9;break;}_context36.next=3;return JSManagement.addJS("ecma5/ExternalLiberary/Search/miladiToJalaliWidthStandardDate.js?dev="+randomVersionName);case 3:$scope.data.removeExternalFuncs["ecma5/ExternalLiberary/Search/miladiToJalaliWidthStandardDate.js?dev="+randomVersionName]='miladiToJalaliWidthStandardDate';_context36.next=6;return miladiToJalaliWidthStandardDate($scope.data.advanceOBJ.date[type]);case 6:date=_context36.sent;$scope.data.filters["system-data-"+type]={title:(type=='from'?'شروع':'پایان')+" زمان ویرایش : "+date,value:_.clone($scope.data.advanceOBJ.date[type]),pointer:$scope.data.advanceOBJ.date,type:"date",bind:type,removeValue:null};_.defer(function(){return $scope.$apply();});case 9:case"end":return _context36.stop();}}},_callee36,_this);}));return function(_x29){return _ref33.apply(this,arguments);};}();$scope.func.selectDocumentType=function(){if($scope.data.advanceOBJ.documentType==null&&typeof $scope.data.filters["documentType-filter"]!=="undefined")delete $scope.data.filters["documentType-filter"];else $scope.data.filters["documentType-filter"]={title:"نوع سند  : "+$scope.data.advanceOBJ.documentType.value,value:_.clone($scope.data.advanceOBJ.documentType.value),type:"documentType",pointer:$scope.data.advanceOBJ,bind:'documentType',removeValue:null};_.defer(function(){return $scope.$apply();});};$scope.func.getDocumentTypes=_asyncToGenerator(regeneratorRuntime.mark(function _callee37(){return regeneratorRuntime.wrap(function _callee37$(_context37){while(1){switch(_context37.prev=_context37.next){case 0:_context37.next=2;return JSManagement.addJS("ecma5/ExternalLiberary/Public/documentTypesArray.js?dev="+randomVersionName);case 2:$scope.data.removeExternalFuncs["ecma5/ExternalLiberary/Public/documentTypesArray.js?dev="+randomVersionName]='documentTypesArray';_context37.next=5;return documentTypesArray();case 5:$scope.data.documentTypes=_context37.sent;return _context37.abrupt("return",$scope.data.documentTypes);case 7:case"end":return _context37.stop();}}},_callee37,_this);}));$scope.func.selectSystematicPath=function(){if($scope.data.advanceOBJ.systematicPath==null&&typeof $scope.data.filters["systematicPath"]!=="undefined")delete $scope.data.filters["systematicPath"];else $scope.data.filters["systematicPath"]={title:"مسیر سیستمی  : "+$scope.data.advanceOBJ.systematicPath.value,value:_.clone($scope.data.advanceOBJ.systematicPath.value),type:"systematicPath",pointer:$scope.data.advanceOBJ,bind:'systematicPath',removeValue:null};_.defer(function(){return $scope.$apply();});};$scope.func.getSystematicPaths=_asyncToGenerator(regeneratorRuntime.mark(function _callee38(){return regeneratorRuntime.wrap(function _callee38$(_context38){while(1){switch(_context38.prev=_context38.next){case 0:_context38.next=2;return JSManagement.addJS("ecma5/ExternalLiberary/Search/systematicPaths.js?dev="+randomVersionName);case 2:$scope.data.removeExternalFuncs["ecma5/ExternalLiberary/Search/systematicPaths.js?dev="+randomVersionName]='systematicPaths';_context38.next=5;return systematicPaths();case 5:$scope.data.systematicPaths=_context38.sent;return _context38.abrupt("return",$scope.data.systematicPaths);case 7:case"end":return _context38.stop();}}},_callee38,_this);}));$scope.func.checkIs2LayerReady=function(){$scope.data.selectOneKeywordAndMetaData=_.filter($scope.data.filters,function(filter,key){return filter.type=='keyWord';}).length>0&&_.filter($scope.data.filters,function(filter,key){return filter.type=='smetadata';}).length>0;if(!$scope.data.selectOneKeywordAndMetaData)$scope.data.metaAndKeywordSet=false;_.defer(function(){return $scope.$apply();});};/**TODO ------------------------- Metadata Functions  ------------------------------------------- **/$scope.func.changeMetaData=function(){$scope.data.metadata=null;if($scope.data.selectMetadata!=null){advanceService.PropertyGroup.form({name:$scope.data.selectMetadata.name}).then(function(res){res.data.isMetaData=false;res.data.properties.unshift({name:res.data.name,value:"",objClass:"com.openkm.bean.form.Input",readonly:false,type:"text",validators:[],width:"100px",isUnique:true,label:'جستجوی کلی'});$scope.data.metadata=_.clone(res.data);console.log($scope.data.metadata);console.info(1);var index=_.findIndex($scope.data.metadata.properties,function(property){return property.name==$scope.data.metadata.name+".pggrpname";});if(index>=0){$scope.data.metadata.properties[index].value=angular.copy($scope.data.metadata.name);}if(_.isFunction($scope.externalScope.InitializationForm))$scope.externalScope.InitializationForm($scope.data.metadata.properties,{service:advanceService,require:false,notReadOnly:true,filter:true});});}};$scope.func.getMetadataList=function(){return new Promise(function(resolve,reject){if($scope.data.metadatas!=null)resolve($scope.data.metadatas);else{advanceService.PropertyGroup.list().then(function(pgres){if(pgres.data!=null){$scope.data.metadatas=_.clone(pgres.data);resolve($scope.data.metadatas);}},function(error){return reject(error);});}});};$scope.func.docName=function(form){if(_.has(form.docName,'$setTouched'))form.docName.$setTouched();if(form.docName.$valid==true){if($scope.data.filters["docName-filter"]&&$scope.data.filters["docName-filter"].value==$scope.data.advanceOBJ.docName)$scope.func.animate("#docName-filter");else{$scope.data.filters["docName-filter"]={title:"نام سند / پوشه : "+$scope.data.advanceOBJ.docName,value:_.clone($scope.data.advanceOBJ.docName),pointer:$scope.data.advanceOBJ,type:"docName",bind:'docName',removeValue:null};}}};$scope.func.selectPath=_asyncToGenerator(regeneratorRuntime.mark(function _callee39(){var path;return regeneratorRuntime.wrap(function _callee39$(_context39){while(1){switch(_context39.prev=_context39.next){case 0:_context39.prev=0;_context39.next=3;return JSManagement.addJS("ecma5/ExternalLiberary/Public/selectPathFromTree.js?dev="+randomVersionName);case 3:$scope.data.removeExternalFuncs["ecma5/ExternalLiberary/Public/selectPathFromTree.js?dev="+randomVersionName]='selectPathFromTree';_context39.next=6;return JSManagement.addJS("ecma5/ExternalLiberary/Public/getNameFromPath.js?dev="+randomVersionName);case 6:$scope.data.removeExternalFuncs["ecma5/ExternalLiberary/Public/getNameFromPath.js?dev="+randomVersionName]='getNameFromPath';_context39.next=9;return selectPathFromTree($uibModal,//modal func
advanceService.repository,//repository service
'getRootFolder',// rootPath
advanceService.folder,// folder service,
getNameFromPath);case 9:path=_context39.sent;$scope.data.advanceOBJ.path=_.clone(path);$scope.data.filters['path-filter']={title:"مسیر : "+$scope.data.advanceOBJ.path,value:_.clone($scope.data.advanceOBJ.path),pointer:$scope.data.advanceOBJ,type:"path",bind:'path',removeValue:null};path=undefined;_context39.next=18;break;case 15:_context39.prev=15;_context39.t0=_context39["catch"](0);console.error(_context39.t0);case 18:case"end":return _context39.stop();}}},_callee39,_this,[[0,15]]);}));$scope.func.selectCategory=_asyncToGenerator(regeneratorRuntime.mark(function _callee40(){var category;return regeneratorRuntime.wrap(function _callee40$(_context40){while(1){switch(_context40.prev=_context40.next){case 0:_context40.prev=0;_context40.next=3;return JSManagement.addJS("ecma5/ExternalLiberary/Public/selectCategoryFromTree.js?dev="+randomVersionName);case 3:$scope.data.removeExternalFuncs["ecma5/ExternalLiberary/Public/selectCategoryFromTree.js?dev="+randomVersionName]='selectCategoryFromTree';_context40.next=6;return JSManagement.addJS("ecma5/ExternalLiberary/Public/getNameFromPath.js?dev="+randomVersionName);case 6:$scope.data.removeExternalFuncs["ecma5/ExternalLiberary/Public/getNameFromPath.js?dev="+randomVersionName]='getNameFromPath';_context40.next=9;return selectCategoryFromTree($uibModal,//modal func
advanceService.repository,//repository service
'getCategoriesFolder',// rootPath
advanceService.folder,// folder service,
getNameFromPath);case 9:category=_context40.sent;$scope.data.advanceOBJ.categories[category.uuid]=true;$scope.data.filters["category-filter-"+category.uuid]={title:"دسته بندی : "+category.label,value:_.clone(category.uuid),pointer:$scope.data.advanceOBJ.categories,type:"category",bind:_.clone(category.uuid),removeValue:false};category=undefined;_context40.next=18;break;case 15:_context40.prev=15;_context40.t0=_context40["catch"](0);console.error(_context40.t0);case 18:case"end":return _context40.stop();}}},_callee40,_this,[[0,15]]);}));$scope.func.author=function(form){if(_.has(form.author,'$setTouched'))form.author.$setTouched();if(form.author.$valid==true){if($scope.data.filters["author-filter"]&&$scope.data.filters["author-filter"].value==$scope.data.advanceOBJ.author)$scope.func.animate("#author-filter");else{$scope.data.filters["author-filter"]={title:"نویسنده : "+$scope.data.advanceOBJ.author,value:_.clone($scope.data.advanceOBJ.author),pointer:$scope.data.advanceOBJ,type:"author",bind:'author',removeValue:null};}}};$scope.func.isNotEmptyFilter=function(){return!_.isEmpty($scope.data.filters);};$scope.func.animate=function(id){return $(id).animate({opacity:'0.2'}).animate({opacity:'1'},"fast",function(){});};$scope.func.content=function(form){if(_.has(form.contentSearch,'$setTouched'))form.contentSearch.$setTouched();if(form.contentSearch.$valid==true){if($scope.data.filters["content-filter"]&&$scope.data.filters["content-filter"]==$scope.data.advanceOBJ.content)$scope.func.animate("#content-filter");else{$scope.data.filters["content-filter"]={title:"محتوا : "+$scope.data.advanceOBJ.content,value:_.clone($scope.data.advanceOBJ.content),type:"content"};$scope.data.advanceOBJ.content=null;}}};$scope.func.note=function(form){if(_.has(form.noteSearch,'$setTouched'))form.noteSearch.$setTouched();if(form.noteSearch.$valid==true){if($scope.data.filters["notes-"+$scope.data.advanceOBJ.note])$scope.func.animate("#notes-"+$scope.data.advanceOBJ.note);else{$scope.data.filters["notes-"+$scope.data.advanceOBJ.note]={title:"یادداشت :   "+$scope.data.advanceOBJ.note,value:_.clone($scope.data.advanceOBJ.note),type:"note"};$scope.data.advanceOBJ.note=null;}}};$scope.func.keyword=function(form){if(_.has(form.keywordSearch,'$setTouched'))form.keywordSearch.$setTouched();if(form.keywordSearch.$valid==true){if($scope.data.filters["keywords-"+$scope.data.advanceOBJ.keyword])$scope.func.animate("#keywords-"+$scope.data.advanceOBJ.keyword);else{$scope.data.filters["keywords-"+$scope.data.advanceOBJ.keyword]={title:"کلید واژه : "+$scope.data.advanceOBJ.keyword,value:_.clone($scope.data.advanceOBJ.keyword),type:"keyWord"};$scope.data.advanceOBJ.keyword=null;}}$scope.func.checkIs2LayerReady();};$scope.func.addItemToFilter=function(keyword){try{switch(keyword.type){case'keyword':if($scope.data.filters["keywords-"+keyword.value])$scope.func.animate("#keywords-"+keyword.value);else{$scope.data.filters["keywords-"+keyword.value]={title:"کلید واژه : "+keyword.value,value:_.clone(keyword.value),type:"keyWord"};}break;case'note':break;}}catch(e){console.error(e);}finally{$scope.func.checkIs2LayerReady();_.defer(function(){return $scope.$apply();});}};$scope.func.removeFilter=function(key){try{delete $scope.data.filters[key];$scope.func.checkIs2LayerReady();_.defer(function(){return $scope.$apply();});}catch(e){toaster.pop('error','','عدم حذف فیلتر انتخابی');}};$scope.func.mainAdvance=function(){};$scope.func.changeAdvanceType=function(){var _ref38=_asyncToGenerator(regeneratorRuntime.mark(function _callee41(name){return regeneratorRuntime.wrap(function _callee41$(_context41){while(1){switch(_context41.prev=_context41.next){case 0:$scope.data.type="advance.type."+name;case 1:case"end":return _context41.stop();}}},_callee41,_this);}));return function(_x30){return _ref38.apply(this,arguments);};}();/**TODO -------------------------  Relation -------------------------------------------------------**/$scope.func.getImageLocal=function(item){return new Promise(function(resolve,reject){try{advanceService.document.thumbnail(item,0,75).then(function(result){return resolve("data:image/png;base64,"+result.data);},function(error){return resolve(getSrcFromType(item.mimeType));});}catch(e){console.error(e);}});};$scope.func.addToRelations=function(){var _ref39=_asyncToGenerator(regeneratorRuntime.mark(function _callee42(sendItem){return regeneratorRuntime.wrap(function _callee42$(_context42){while(1){switch(_context42.prev=_context42.next){case 0:_context42.prev=0;$scope.func.advanceAddToRelations(sendItem);_context42.next=21;break;case 4:_context42.prev=4;_context42.t0=_context42["catch"](0);_context42.prev=6;_context42.next=9;return JSManagement.addJS("ecma5/ExternalLiberary/Search/insideController/functions/advanceAddToRelations.js?dev="+randomVersionName);case 9:$scope.data.removeExternalFuncs["ecma5/ExternalLiberary/Search/insideController/functions/advanceAddToRelations.js?dev="+randomVersionName]="advanceAddToRelationsAdvanceCtrl";_context42.next=12;return advanceAddToRelationsAdvanceCtrl($scope,advanceService,JSManagement,CSSManagement,toaster,$uibModal,$translate);case 12:$scope.func.advanceAddToRelations(sendItem);_context42.next=18;break;case 15:_context42.prev=15;_context42.t1=_context42["catch"](6);console.error(_context42.t1);case 18:_context42.prev=18;_.defer(function(){return $scope.$apply();});return _context42.finish(18);case 21:case"end":return _context42.stop();}}},_callee42,_this,[[0,4],[6,15,18,21]]);}));return function(_x31){return _ref39.apply(this,arguments);};}();$scope.func.removeRelationItem=function(){var _ref40=_asyncToGenerator(regeneratorRuntime.mark(function _callee43(id){return regeneratorRuntime.wrap(function _callee43$(_context43){while(1){switch(_context43.prev=_context43.next){case 0:_context43.prev=0;if(!($scope.data.relationStorage!=null)){_context43.next=24;break;}_context43.prev=2;if(!_.has($scope.data.relationStorage.footers,id)){_context43.next=19;break;}$scope.data.relationStorage.footers[id]=undefined;delete $scope.data.relationStorage.footers[id];if(!(_.isEqual($scope.data.relationStorage.footers,{})&&$scope.data.relationStorage.header==null)){_context43.next=11;break;}$scope.data.relationStorage=null;$scope.func.hiddenRelationsList();_context43.next=19;break;case 11:_context43.prev=11;_context43.next=14;return setSelectedLocalStorage(_.clone($scope.data.relationStorage),'relations');case 14:_context43.next=19;break;case 16:_context43.prev=16;_context43.t0=_context43["catch"](11);console.error(_context43.t0);case 19:_context43.next=24;break;case 21:_context43.prev=21;_context43.t1=_context43["catch"](2);console.error(_context43.t1);case 24:_context43.next=29;break;case 26:_context43.prev=26;_context43.t2=_context43["catch"](0);console.error(_context43.t2);case 29:case"end":return _context43.stop();}}},_callee43,_this,[[0,26],[2,21],[11,16]]);}));return function(_x32){return _ref40.apply(this,arguments);};}();$scope.func.removeHeaderRelationItem=_asyncToGenerator(regeneratorRuntime.mark(function _callee44(){return regeneratorRuntime.wrap(function _callee44$(_context44){while(1){switch(_context44.prev=_context44.next){case 0:if(!($scope.data.relationStorage!=null)){_context44.next=15;break;}$scope.data.relationStorage.header=null;if(!_.isEqual($scope.data.relationStorage.footers,{})){_context44.next=7;break;}$scope.data.relationStorage=null;$scope.func.hiddenRelationsList();_context44.next=15;break;case 7:_context44.prev=7;_context44.next=10;return setSelectedLocalStorage(_.clone($scope.data.relationStorage),'relations');case 10:_context44.next=15;break;case 12:_context44.prev=12;_context44.t0=_context44["catch"](7);console.error(_context44.t0);case 15:case"end":return _context44.stop();}}},_callee44,_this,[[7,12]]);}));$scope.func.showRelationsList=_asyncToGenerator(regeneratorRuntime.mark(function _callee45(){return regeneratorRuntime.wrap(function _callee45$(_context45){while(1){switch(_context45.prev=_context45.next){case 0:if(!($scope.data.relationStorage==null)){_context45.next=12;break;}_context45.prev=1;_context45.next=4;return getSelectedLocalStorage('relations');case 4:$scope.data.relationStorage=_context45.sent;if($scope.data.relationStorage==null)$scope.data.relationStorage={header:null,footers:{}};_context45.next=12;break;case 8:_context45.prev=8;_context45.t0=_context45["catch"](1);console.error(_context45.t0);return _context45.abrupt("return");case 12:$scope.data.showRelations=true;try{$("#relationsViewer").draggable({"axis":"x","containment":"body"});}catch(e){console.error(e);}_.defer(function(){return $scope.$apply();});case 15:case"end":return _context45.stop();}}},_callee45,_this,[[1,8]]);}));$scope.func.hiddenRelationsList=_asyncToGenerator(regeneratorRuntime.mark(function _callee46(){return regeneratorRuntime.wrap(function _callee46$(_context46){while(1){switch(_context46.prev=_context46.next){case 0:$scope.data.showRelations=false;if(!($scope.data.relationStorage==null)){_context46.next=12;break;}_context46.prev=2;_context46.next=5;return removeSelectedLocalStorage('relations');case 5:_context46.next=10;break;case 7:_context46.prev=7;_context46.t0=_context46["catch"](2);console.error(_context46.t0);case 10:_context46.next=20;break;case 12:_context46.prev=12;_context46.next=15;return setSelectedLocalStorage(_.clone($scope.data.relationStorage),'relations');case 15:_context46.next=20;break;case 17:_context46.prev=17;_context46.t1=_context46["catch"](12);console.error(_context46.t1);case 20:_.defer(function(){return $scope.$apply();});case 21:case"end":return _context46.stop();}}},_callee46,_this,[[2,7],[12,17]]);}));$scope.func.pinToLocationRelation=function(){try{$scope.data.relationsPushed=!$scope.data.relationsPushed;try{$("#relationsViewer").draggable($scope.data.relationsPushed?'disable':'enable');}catch(e){console.error(e);}_.defer(function(){return $scope.$apply();});}catch(e){console.error(e);}};$scope.func.addRelationsToserver=function(){/* try{
                        if($scope.data.relationStorage == null){
                            toaster.pop('warning', '', 'لطفا ابتدا روابط را انتخاب کنید .');
                        }
                        else if(){

                        }
                    }
                    catch(e){
                        console.error(e);
                    }*/if($scope.data.relationStorage!=null){if($scope.data.relationStorage.header!=null){if(!_.isEqual($scope.data.relationStorage.footers,{})){if(_.filter($scope.data.relationStorage.footers,function(v,k){return!_.has(v,'relation')||_.includes(["",null],v.relation);}).length==0){var query="";_.forEach($scope.data.relationStorage.footers,function(v,k){return query+="relation="+$scope.data.relationStorage.header.uuid+"="+k+"="+v.relation+"&";});if(query.endsWith("&"))query=query.slice(0,query.length-1);advanceService.relation.createRelations(query).then(function(res){toaster.pop('success','','رابطه با موفقیت ایجاد شد.');},function(error){return toaster.pop('error','','مشکلی در ایجاد رابطه به وجود آمده است.');});}else{toaster.pop('error','','لطفا نوع رابطه تمام زیر شاخه ها را مشخص کنید.');}}else{toaster.pop('error','','لطفا حداقل یک زیر شاخه انتخاب کنید.');}}else{toaster.pop('error','','لطفا ابتدا یک سرشاخه انتخاب کنید.');}}else{toaster.pop('error','','لطفا ابتدا روابط را انتخاب کنید.');}};$scope.func.getRelationsList=function(){return new Promise(function(resolve,reject){try{if($scope.data.relations!=null)resolve($scope.data.relations);else{advanceService.relation.listDefinition().then(function(pgres){if(pgres.data!=null){$scope.data.relations=_.clone(pgres.data);resolve($scope.data.relations);}else reject(null);},function(error){return reject(error);});}}catch(e){console.error(e);reject(null);}});};$scope.func.removeRelation=_asyncToGenerator(regeneratorRuntime.mark(function _callee47(){var response;return regeneratorRuntime.wrap(function _callee47$(_context47){while(1){switch(_context47.prev=_context47.next){case 0:_context47.prev=0;if(!($scope.data.relationStorage!=null&&(_.has($scope.data.relationStorage,'header')&&$scope.data.relationStorage.header!=null||_.has($scope.data.relationStorage,'footers')&&!_.isEqual($scope.data.relationStorage.footers,{})))){_context47.next=14;break;}_context47.next=4;return JSManagement.addJS("ecma5/ExternalLiberary/Search/deleteRelationSearchCtrl.js?dev="+randomVersionName);case 4:_context47.next=6;return deleteRelationSearchCtrl($uibModal);case 6:response=_context47.sent;if(!response){_context47.next=12;break;}$scope.data.relationStorage=null;_context47.next=11;return JSManagement.removeJS("ecma5/ExternalLiberary/Desktop/deleteRelation.js?dev="+randomVersionName,'deleteRelationDesktopCtrl');case 11:$scope.func.hiddenRelationsList();case 12:_context47.next=15;break;case 14:toaster.pop('error','','شما رابطه ای برای حذف کردن ندارید.');case 15:_context47.next=22;break;case 17:_context47.prev=17;_context47.t0=_context47["catch"](0);console.error(_context47.t0);_context47.next=22;return JSManagement.removeJS("ecma5/ExternalLiberary/Desktop/deleteRelation.js?dev="+randomVersionName,'deleteRelationDesktopCtrl');case 22:case"end":return _context47.stop();}}},_callee47,_this,[[0,17]]);}));/**TODO -------------------------  SelectedResult ------------------------------------------------**/$scope.func.addToSelectedResults=function(){var _ref45=_asyncToGenerator(regeneratorRuntime.mark(function _callee48(item){var selectedResults;return regeneratorRuntime.wrap(function _callee48$(_context48){while(1){switch(_context48.prev=_context48.next){case 0:_context48.prev=0;_context48.prev=1;_context48.next=4;return getSelectedLocalStorage('selectedResults');case 4:selectedResults=_context48.sent;if(selectedResults==null)selectedResults={};if(!_.has(selectedResults,item.uuid)){_context48.next=10;break;}toaster.pop('info','','این آیتم قبلا به لیست انتخابی اضافه شده است.');_context48.next=21;break;case 10:selectedResults[item.uuid]=_.clone(item);_context48.prev=11;_context48.next=14;return setSelectedLocalStorage(_.clone(selectedResults),'selectedResults');case 14:_context48.next=19;break;case 16:_context48.prev=16;_context48.t0=_context48["catch"](11);console.error(_context48.t0);case 19:$scope.data.selectedResultStorage=_.clone(selectedResults);toaster.pop('success','','آیتم با موفقیت به لیست انتخابی افزوده شد.');case 21:selectedResults=undefined;_context48.next=27;break;case 24:_context48.prev=24;_context48.t1=_context48["catch"](1);console.error(_context48.t1);case 27:_context48.next=32;break;case 29:_context48.prev=29;_context48.t2=_context48["catch"](0);console.error(_context48.t2);case 32:case"end":return _context48.stop();}}},_callee48,_this,[[0,29],[1,24],[11,16]]);}));return function(_x33){return _ref45.apply(this,arguments);};}();$scope.func.removeSelectedResultItem=function(){var _ref46=_asyncToGenerator(regeneratorRuntime.mark(function _callee49(id){return regeneratorRuntime.wrap(function _callee49$(_context49){while(1){switch(_context49.prev=_context49.next){case 0:_context49.prev=0;if(!($scope.data.selectedResultStorage!=null)){_context49.next=24;break;}_context49.prev=2;if(!_.has($scope.data.selectedResultStorage,id)){_context49.next=19;break;}$scope.data.selectedResultStorage[id]=undefined;delete $scope.data.selectedResultStorage[id];if(!_.isEqual($scope.data.selectedResultStorage,{})){_context49.next=11;break;}$scope.data.selectedResultStorage=null;$scope.func.hiddenSelectedResultList();_context49.next=19;break;case 11:_context49.prev=11;_context49.next=14;return setSelectedLocalStorage(_.clone($scope.data.selectedResultStorage),'selectedResults');case 14:_context49.next=19;break;case 16:_context49.prev=16;_context49.t0=_context49["catch"](11);console.error(_context49.t0);case 19:_context49.next=24;break;case 21:_context49.prev=21;_context49.t1=_context49["catch"](2);console.error(_context49.t1);case 24:_context49.next=29;break;case 26:_context49.prev=26;_context49.t2=_context49["catch"](0);console.error(_context49.t2);case 29:case"end":return _context49.stop();}}},_callee49,_this,[[0,26],[2,21],[11,16]]);}));return function(_x34){return _ref46.apply(this,arguments);};}();$scope.func.hiddenSelectedResultList=_asyncToGenerator(regeneratorRuntime.mark(function _callee50(){return regeneratorRuntime.wrap(function _callee50$(_context50){while(1){switch(_context50.prev=_context50.next){case 0:$scope.data.showSelectedResult=false;if(!($scope.data.selectedResultStorage==null)){_context50.next=12;break;}_context50.prev=2;_context50.next=5;return removeSelectedLocalStorage('selectedResults');case 5:_context50.next=10;break;case 7:_context50.prev=7;_context50.t0=_context50["catch"](2);console.error(_context50.t0);case 10:_context50.next=20;break;case 12:_context50.prev=12;_context50.next=15;return setSelectedLocalStorage(_.clone($scope.data.selectedResultStorage),'selectedResults');case 15:_context50.next=20;break;case 17:_context50.prev=17;_context50.t1=_context50["catch"](12);console.error(_context50.t1);case 20:_.defer(function(){return $scope.$apply();});case 21:case"end":return _context50.stop();}}},_callee50,_this,[[2,7],[12,17]]);}));$scope.func.pinToSelectedResult=function(){try{$scope.data.selectedResultPushed=!$scope.data.selectedResultPushed;try{$("#selectedResultViewer").draggable($scope.data.selectedResultPushed?'disable':'enable');}catch(e){console.error(e);}_.defer(function(){return $scope.$apply();});}catch(e){console.error(e);}};$scope.func.removeSelectedResult=_asyncToGenerator(regeneratorRuntime.mark(function _callee51(){return regeneratorRuntime.wrap(function _callee51$(_context51){while(1){switch(_context51.prev=_context51.next){case 0:_context51.prev=0;if($scope.data.selectedResultStorage!=null&&!_.isEqual($scope.data.selectedResultStorage,{})){$scope.data.selectedResultStorage=null;$scope.func.hiddenSelectedResultList();}else toaster.pop('error','','شما رابطه ای برای حذف کردن ندارید.');_context51.next=9;break;case 4:_context51.prev=4;_context51.t0=_context51["catch"](0);console.error(_context51.t0);_context51.next=9;return JSManagement.removeJS("ecma5/ExternalLiberary/Desktop/deleteRelation.js?dev="+randomVersionName,'deleteRelationDesktopCtrl');case 9:case"end":return _context51.stop();}}},_callee51,_this,[[0,4]]);}));$scope.func.showSelectedResultsList=_asyncToGenerator(regeneratorRuntime.mark(function _callee52(){return regeneratorRuntime.wrap(function _callee52$(_context52){while(1){switch(_context52.prev=_context52.next){case 0:if(!($scope.data.relationStorage==null)){_context52.next=12;break;}_context52.prev=1;_context52.next=4;return getSelectedLocalStorage('selectedResults');case 4:$scope.data.selectedResultStorage=_context52.sent;if($scope.data.selectedResultStorage==null)$scope.data.selectedResultStorage={};_context52.next=12;break;case 8:_context52.prev=8;_context52.t0=_context52["catch"](1);console.error(_context52.t0);return _context52.abrupt("return");case 12:$scope.data.showSelectedResult=true;try{$("#selectedResultViewer").draggable({"axis":"x","containment":"body"});}catch(e){console.error(e);}_.defer(function(){return $scope.$apply();});case 15:case"end":return _context52.stop();}}},_callee52,_this,[[1,8]]);}));$scope.func.addSelectedResultToserver=function(){try{if($scope.data.selectedResultStorage==null)throw new Error('لطفا حداقل یک سند یا پوشه انتخاب کنید.');if(_.isEqual($scope.data.selectedResultStorage,{}))throw new Error('لطفا حداقل یک سند یا پوشه انتخاب کنید.');var query="";_.forEach($scope.data.selectedResultStorage,function(v,k){return query+="selected="+v.uuid+"="+k+"}&";});if(query.endsWith("&"))query=query.slice(0,query.length-1);}catch(e){toaster.pop('error','',e.message||e);}};$scope.func.changeResultSearchedMetaData=_asyncToGenerator(regeneratorRuntime.mark(function _callee53(){var query,res;return regeneratorRuntime.wrap(function _callee53$(_context53){while(1){switch(_context53.prev=_context53.next){case 0:if(!(!_.isArray($scope.data.list)||$scope.data.list.length<=0)){_context53.next=4;break;}toaster.pop("error","","آیتمی جهت ویرایش در نتایج دیده نشده است .");_context53.next=25;break;case 4:if(!(_.filter($scope.data.filters,function(filter,key){return filter.type=="smetadata";}).length==0)){_context53.next=8;break;}toaster.pop("error","","حداقل یک فراداده انتخاب کنید .");_context53.next=25;break;case 8:_context53.prev=8;_context53.next=11;return createQueryFromFilters(_.clone($scope.data.filters),// query objects
0,// offset
0// range
);case 11:query=_context53.sent;_context53.next=14;return JSManagement.addJS("ecma5/ExternalLiberary/Search/changeResultSearchedMetaData.js?dev="+randomVersionName);case 14:_context53.next=16;return changeResultSearchedMetaData($uibModal,_.clone(query),_.clone($scope.data.filters),advanceService,JSManagement);case 16:res=_context53.sent;toaster.pop('success','',res);_context53.next=20;return JSManagement.addJS("ecma5/ExternalLiberary/Search/changeResultSearchedMetaData.js?dev="+randomVersionName);case 20:_context53.next=25;break;case 22:_context53.prev=22;_context53.t0=_context53["catch"](8);toaster.pop('error','',_context53.t0||_context53.t0.message);case 25:case"end":return _context53.stop();}}},_callee53,_this,[[8,22]]);}));/**TODO -------------------------  Fill In State --------------------------------------------------**/$scope.func.fillItems=function(search){return new Promise(function(){var _ref51=_asyncToGenerator(regeneratorRuntime.mark(function _callee54(resolve,reject){return regeneratorRuntime.wrap(function _callee54$(_context54){while(1){switch(_context54.prev=_context54.next){case 0:_context54.prev=0;console.log(search);//TODO Keywords
_context54.prev=2;_context54.next=5;return $scope.func.advanceFillItems(search,reject,resolve);case 5:_context54.next=27;break;case 7:_context54.prev=7;_context54.t0=_context54["catch"](2);console.error(_context54.t0);_context54.prev=10;_context54.next=13;return JSManagement.addJS("ecma5/ExternalLiberary/Search/insideController/functions/advanceFillItems.js?dev="+randomVersionName);case 13:$scope.data.removeExternalFuncs["ecma5/ExternalLiberary/Search/insideController/functions/advanceFillItems.js?dev="+randomVersionName]="advanceFillItemsAdvanceCtrl";_context54.next=16;return advanceFillItemsAdvanceCtrl($scope,advanceService,JSManagement,CSSManagement,toaster,$uibModal,$translate);case 16:_context54.next=18;return $scope.func.advanceFillItems(search,reject,resolve);case 18:_context54.next=23;break;case 20:_context54.prev=20;_context54.t1=_context54["catch"](10);console.error(_context54.t1);case 23:_context54.prev=23;_.defer(function(){return $scope.$apply();});resolve(true);return _context54.finish(23);case 27:_context54.next=32;break;case 29:_context54.prev=29;_context54.t2=_context54["catch"](0);reject(_context54.t2);case 32:case"end":return _context54.stop();}}},_callee54,_this,[[0,29],[2,7],[10,20,23,27]]);}));return function(_x35,_x36){return _ref51.apply(this,arguments);};}());};$scope.func.fillSate=_asyncToGenerator(regeneratorRuntime.mark(function _callee55(){return regeneratorRuntime.wrap(function _callee55$(_context55){while(1){switch(_context55.prev=_context55.next){case 0:_context55.prev=0;$scope.func.advanceFillSate();_context55.next=22;break;case 4:_context55.prev=4;_context55.t0=_context55["catch"](0);console.error(_context55.t0);_context55.prev=7;_context55.next=10;return JSManagement.addJS("ecma5/ExternalLiberary/Search/insideController/functions/advanceFillSate.js?dev="+randomVersionName);case 10:$scope.data.removeExternalFuncs["ecma5/ExternalLiberary/Search/insideController/functions/advanceFillSate.js?dev="+randomVersionName]="advanceFillSateAdvanceCtrl";_context55.next=13;return advanceFillSateAdvanceCtrl($scope,advanceService,JSManagement,CSSManagement,toaster,$uibModal,$translate);case 13:$scope.func.advanceFillSate();_context55.next=19;break;case 16:_context55.prev=16;_context55.t1=_context55["catch"](7);console.error(_context55.t1);case 19:_context55.prev=19;_.defer(function(){return $scope.$apply();});return _context55.finish(19);case 22:case"end":return _context55.stop();}}},_callee55,_this,[[0,4],[7,16,19,22]]);}));/**TODO -------------------------  RUN ------------------------------------------------------------**/$scope.func.run=_asyncToGenerator(regeneratorRuntime.mark(function _callee56(){return regeneratorRuntime.wrap(function _callee56$(_context56){while(1){switch(_context56.prev=_context56.next){case 0:_context56.prev=0;_context56.next=3;return FeaturesManagement.getFeatures(advanceService.auth);case 3:$scope.data.profile=_context56.sent;$scope.func.fillSate();_context56.next=10;break;case 7:_context56.prev=7;_context56.t0=_context56["catch"](0);toaster.pop('error','',_context56.t0);case 10:case"end":return _context56.stop();}}},_callee56,_this,[[0,7]]);}));/**TODO -------------------------  Destroy State --------------------------------------------------**/$scope.$on("$destroy",_asyncToGenerator(regeneratorRuntime.mark(function _callee59(){var json;return regeneratorRuntime.wrap(function _callee59$(_context59){while(1){switch(_context59.prev=_context59.next){case 0:_context59.prev=0;try{$(".advance .advance-nicescroll").getNiceScroll().hide();$(".advance .advance-nicescroll").getNiceScroll().remove();}catch(e){console.error(e);}window.clearAllIntervals();_context59.next=5;return JSManagement.addJS("ecma5/ExternalLiberary/Search/saveSearchGenerator.js?dev="+randomVersionName);case 5:_context59.next=7;return saveSearchGeneratorFunction(_.clone($scope.data.filters),"savedFilters");case 7:json=_context59.sent;_context59.prev=8;_context59.prev=9;_context59.next=12;return removeSelectedLocalStorage('state.advance');case 12:_context59.next=17;break;case 14:_context59.prev=14;_context59.t0=_context59["catch"](9);console.error(_context59.t0);case 17:_context59.prev=17;json.queryParams.properties=_.keyBy(_.map(json.queryParams.properties.entry,function(property){var p=property.value;p.key=property.key;return p;}),'key');json=_.clone(json.queryParams);json.metaAndKeywordSet=angular.copy($scope.data.metaAndKeywordSet);_context59.next=23;return setSelectedLocalStorage(_.clone({offset:_.clone($scope.data.advanceOBJ.offset),range:$scope.data.advanceOBJ.range,filters:_.clone(json)}),'state.advance');case 23:_context59.next=28;break;case 25:_context59.prev=25;_context59.t1=_context59["catch"](17);console.error(_context59.t1);case 28:_context59.next=33;break;case 30:_context59.prev=30;_context59.t2=_context59["catch"](8);console.error(_context59.t2);case 33:json=undefined;_.forEach(_.clone($scope.data.removeExternalCSS),function(){var _ref55=_asyncToGenerator(regeneratorRuntime.mark(function _callee57(value,src){return regeneratorRuntime.wrap(function _callee57$(_context57){while(1){switch(_context57.prev=_context57.next){case 0:_context57.prev=0;_context57.next=3;return CSSManagement.removeCSS(src);case 3:_context57.next=8;break;case 5:_context57.prev=5;_context57.t0=_context57["catch"](0);console.error(_context57.t0);case 8:case"end":return _context57.stop();}}},_callee57,_this,[[0,5]]);}));return function(_x37,_x38){return _ref55.apply(this,arguments);};}());_.forEach(_.clone($scope.data.removeExternalFuncs),function(){var _ref56=_asyncToGenerator(regeneratorRuntime.mark(function _callee58(funcName,src){return regeneratorRuntime.wrap(function _callee58$(_context58){while(1){switch(_context58.prev=_context58.next){case 0:_context58.prev=0;_context58.next=3;return JSManagement.removeJS(src,funcName);case 3:_context58.next=8;break;case 5:_context58.prev=5;_context58.t0=_context58["catch"](0);console.error(_context58.t0);case 8:case"end":return _context58.stop();}}},_callee58,_this,[[0,5]]);}));return function(_x39,_x40){return _ref56.apply(this,arguments);};}());$scope.func=undefined;$scope.data=undefined;$scope.getScopeItems=undefined;$scope.externalScopeParent=undefined;$scope.externalScope=undefined;_context59.next=46;break;case 43:_context59.prev=43;_context59.t3=_context59["catch"](0);console.error(_context59.t3);case 46:case"end":return _context59.stop();}}},_callee59,_this,[[0,43],[8,30],[9,14],[17,25]]);})));/**TODO -------------------------  Successfull load state -----------------------------------------**/$scope.$on('changeFeature',function(){var _ref57=_asyncToGenerator(regeneratorRuntime.mark(function _callee60(event,args){return regeneratorRuntime.wrap(function _callee60$(_context60){while(1){switch(_context60.prev=_context60.next){case 0:if(!(typeof args.changeInfo!=="undefined"&&args.changeInfo==true)){_context60.next=5;break;}_context60.next=3;return FeaturesManagement.getFeatures(advanceService.auth);case 3:$scope.data.profile=_context60.sent;$scope.func.fillSate();case 5:case"end":return _context60.stop();}}},_callee60,_this);}));return function(_x41,_x42){return _ref57.apply(this,arguments);};}());resolve(true);}catch(e){toaster.pop("error","","مشکلی در ورود به جستجوی پیشرفته به وجود آمده است.");reject("مشکلی در ساخت State ایجاد شده است.");}});};