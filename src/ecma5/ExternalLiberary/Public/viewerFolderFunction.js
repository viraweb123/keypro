'use strict';function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value;}catch(error){reject(error);return;}if(info.done){resolve(value);}else{return Promise.resolve(value).then(function(value){return step("next",value);},function(err){return step("throw",err);});}}return step("next");});};}var viewerFolderFunction=function viewerFolderFunction(_uibModal,_JS,_CSS,_service,_selectItem,_profile){return new Promise(function(resolve,reject){var _this=this;var modalInstance=_uibModal.open({templateUrl:'ecma5/ExternalLiberary/Public/viewerFolderFunction.html?dev='+randomVersionName,controller:function controller($scope,$uibModalInstance,$compile,toaster,$upload,JS,CSS,service,selectItem,profile,uibModal){$scope.externalScopeFill={InitializationForm:null,footer:{'next':{'id':'success','click':function click(properties,form){return $scope.func.editMetaData(properties,form);},'icon':'fa-floppy-o','label':'تغییرات','form':null,'property':null},'prev':{'id':'cancel','click':function click(properties,form){return $scope.func.removeMetaData();},'icon':'fa-trash','label':'حذف','form':null,'property':null}}};$scope.data={navigation:{activatedIcon:'metadata',header:'فراداده'},changeNav:{'metadata':{activatedIcon:'metadata',header:'فراداده'},'keyword':{activatedIcon:'keyword',header:'کلید واژه'},'note':{activatedIcon:'note',header:'نکته ها'},'user':{activatedIcon:'user',header:'امنیت کاربران'},'role':{activatedIcon:'role',header:'امنیت قوانین'},'feature':{activatedIcon:'feature',header:'خصوصیات'}},Keyword:{data:null},note:{data:null,action:'create',isActive:-1},currentFileOrFolder:null,isRunScrollFunc:false,notConfig:true,profile:profile,Folder:null,File:null,list:{},removeExternalFuncs:{},removeExternalCSS:{},Selectedfolder:null,//angular.copy(folder),
group:null,selectedUuid:null,dbClicked:0,viewer:{type:null,media:{type:""},pdf:{url:null,changeURL:null,firstSearch:null,isOpenfileShower:false,showIcons:{printer:true},showPDF:false},player:{func:null},html:{content:null},image:{func:null}},isNewThumbnailsRequest:true,propertyGroupSelected:null,clonePropertyGroupSelected:null,breadcrumbList:[],activateItemUUID:-1,state:'view',fileData:null,filesList:{},startUpload:false,minimize:{right:false,left:false},security:{Users:null,Roles:null}};$scope.func={};/***************************************************************************************//*                                                                                     *//*                                   Navigation FUNCTIONS                              *//*                                                                                     *//***************************************************************************************/$scope.func.showLeftItem=function(activatedIcon,isNeccessary){try{if(activatedIcon!=$scope.data.navigation.activatedIcon||activatedIcon!=null||typeof isNeccessary!=="undefined"){$scope.data.navigation=$scope.data.changeNav[activatedIcon];switch(activatedIcon){case"user":if($scope.data.security.Users==null){service.auth.listUser($scope.data.currentFileOrFolder.uuid).then(function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(res){return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(res.data!=null&&_.isArray(res.data))){_context.next=9;break;}_context.next=3;return JS.addJS('ecma5/ExternalLiberary/Public/getPermisionArray.js?dev='+randomVersionName);case 3:$scope.data.removeExternalFuncs['ecma5/ExternalLiberary/Public/getPermisionArray.js?dev='+randomVersionName]='getPermisionArray';_.forEach(res.data,function(v){return v.securityArray=getPermisionArray(v.permissions);});$scope.data.security.Users=_.clone(res.data);_.remove($scope.data.security.Users,function(role){return role.permissions==0;});_context.next=10;break;case 9:$scope.data.security.Users=null;case 10:_.defer(function(){return $scope.$apply();});case 11:case'end':return _context.stop();}}},_callee,_this);}));return function(_x){return _ref.apply(this,arguments);};}(),function(error){return toaster.pop('error','','عدم دریافت اطلاعات');});}break;case"role":if($scope.data.security.Roles==null){service.auth.listRole($scope.data.currentFileOrFolder.uuid).then(function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(res){return regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!(res.data!=null&&_.isArray(res.data))){_context2.next=9;break;}_context2.next=3;return JS.addJS('ecma5/ExternalLiberary/Public/getPermisionArray.js?dev='+randomVersionName);case 3:$scope.data.removeExternalFuncs['ecma5/ExternalLiberary/Public/getPermisionArray.js?dev='+randomVersionName]='getPermisionArray';_.forEach(res.data,function(v){return v.securityArray=getPermisionArray(v.permissions);});$scope.data.security.Roles=_.clone(res.data);_.remove($scope.data.security.Roles,function(role){return role.permissions==0;});_context2.next=10;break;case 9:$scope.data.security.Roles=null;case 10:_.defer(function(){return $scope.$apply();});case 11:case'end':return _context2.stop();}}},_callee2,_this);}));return function(_x2){return _ref2.apply(this,arguments);};}(),function(error){return toaster.pop('error','','عدم دریافت اطلاعات');});}break;}}}catch(e){console.error(e||e.message);}finally{_.defer(function(){return $scope.$apply();});}};/***************************************************************************************//*                                                                                     *//*                                   SECURITY FUNCTIONS                                *//*                                                                                     *//***************************************************************************************/$scope.func.updateUsers=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(){return regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.prev=0;if(!$scope.data.currentFileOrFolder.permisionArray[0]){_context4.next=11;break;}_context4.next=4;return JS.addJS('ecma5/ExternalLiberary/Desktop/updateSecurityUsersFunc.js?dev='+randomVersionName);case 4:_context4.next=6;return updateSecurityUsersFunc(uibModal,$scope.data.security.Users,service,$scope.data.currentFileOrFolder.uuid);case 6:_context4.next=8;return JS.removeJS('ecma5/ExternalLiberary/Desktop/updateSecurityUsersFunc.js?dev='+randomVersionName,'updateSecurityUsersFunc');case 8:service.auth.listUser($scope.data.currentFileOrFolder.uuid).then(function(){var _ref4=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(res){return regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(!(res.data!=null&&_.isArray(res.data))){_context3.next=9;break;}_context3.next=3;return JS.addJS('ecma5/ExternalLiberary/Public/getPermisionArray.js?dev='+randomVersionName);case 3:$scope.data.removeExternalFuncs['ecma5/ExternalLiberary/Public/getPermisionArray.js?dev='+randomVersionName]='getPermisionArray';_.forEach(res.data,function(v){return v.securityArray=getPermisionArray(v.permissions);});$scope.data.security.Users=_.clone(res.data);_.remove($scope.data.security.Users,function(role){return role.permissions==0;});_context3.next=10;break;case 9:$scope.data.security.Users=null;case 10:_.defer(function(){return $scope.$apply();});case 11:case'end':return _context3.stop();}}},_callee3,_this);}));return function(_x3){return _ref4.apply(this,arguments);};}(),function(error){return toaster.pop('error','','عدم دریافت اطلاعات');});_context4.next=12;break;case 11:toaster.pop('error',"","شما مجوز ویرایش دسترسی کاربران به این سند را ندارید.");case 12:_context4.next=17;break;case 14:_context4.prev=14;_context4.t0=_context4['catch'](0);console.error(_context4.t0);case 17:case'end':return _context4.stop();}}},_callee4,_this,[[0,14]]);}));$scope.func.toggleUserView=function(){var _ref5=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(userIndex){var permissions;return regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.prev=0;if(!$scope.data.currentFileOrFolder.permisionArray[0]){_context5.next=21;break;}permissions=$scope.data.security.Users[userIndex].securityArray[3]==1?$scope.data.security.Users[userIndex].permissions-1:$scope.data.security.Users[userIndex].permissions+1;_context5.prev=3;_context5.next=6;return service.auth.grantRevokeUser($scope.data.currentFileOrFolder.uuid,$scope.data.security.Users[userIndex].user,permissions,false);case 6:$scope.data.security.Users[userIndex].permissions=angular.copy(permissions);permissions=undefined;$scope.data.security.Users[userIndex].securityArray[3]=Math.abs($scope.data.security.Users[userIndex].securityArray[3]-1);if($scope.data.security.Users[userIndex].permissions==0)$scope.data.security.Users.splice(userIndex,1);toaster.pop("success","","امنیت با موفقیت تغییر کرد .");_context5.next=16;break;case 13:_context5.prev=13;_context5.t0=_context5['catch'](3);toaster.pop("error","","مشکلی در تغییر امنیت به وجود آمده است .");case 16:_context5.prev=16;_.defer(function(){return $scope.$apply();});return _context5.finish(16);case 19:_context5.next=22;break;case 21:toaster.pop('error',"","شما مجوز ویرایش دسترسی کاربران به این سند را ندارید.");case 22:_context5.next=27;break;case 24:_context5.prev=24;_context5.t1=_context5['catch'](0);console.error(_context5.t1);case 27:case'end':return _context5.stop();}}},_callee5,_this,[[0,24],[3,13,16,19]]);}));return function(_x4){return _ref5.apply(this,arguments);};}();$scope.func.toggleUserEdit=function(){var _ref6=_asyncToGenerator(regeneratorRuntime.mark(function _callee6(userIndex){var permissions;return regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.prev=0;if(!$scope.data.currentFileOrFolder.permisionArray[0]){_context6.next=21;break;}permissions=$scope.data.security.Users[userIndex].securityArray[2]==1?$scope.data.security.Users[userIndex].permissions-2:$scope.data.security.Users[userIndex].permissions+2;_context6.prev=3;_context6.next=6;return service.auth.grantRevokeUser($scope.data.currentFileOrFolder.uuid,$scope.data.security.Users[userIndex].user,permissions,false);case 6:$scope.data.security.Users[userIndex].permissions=angular.copy(permissions);permissions=undefined;$scope.data.security.Users[userIndex].securityArray[2]=Math.abs($scope.data.security.Users[userIndex].securityArray[2]-1);if($scope.data.security.Users[userIndex].permissions==0)$scope.data.security.Users.splice(userIndex,1);toaster.pop("success","","امنیت با موفقیت تغییر کرد .");_context6.next=16;break;case 13:_context6.prev=13;_context6.t0=_context6['catch'](3);toaster.pop("error","","مشکلی در تغییر امنیت به وجود آمده است .");case 16:_context6.prev=16;_.defer(function(){return $scope.$apply();});return _context6.finish(16);case 19:_context6.next=22;break;case 21:toaster.pop('error',"","شما مجوز ویرایش دسترسی کاربران به این سند را ندارید.");case 22:_context6.next=27;break;case 24:_context6.prev=24;_context6.t1=_context6['catch'](0);console.error(_context6.t1);case 27:case'end':return _context6.stop();}}},_callee6,_this,[[0,24],[3,13,16,19]]);}));return function(_x5){return _ref6.apply(this,arguments);};}();$scope.func.toggleUserTrash=function(){var _ref7=_asyncToGenerator(regeneratorRuntime.mark(function _callee7(userIndex){var permissions;return regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:_context7.prev=0;if(!$scope.data.currentFileOrFolder.permisionArray[0]){_context7.next=21;break;}permissions=$scope.data.security.Users[userIndex].securityArray[1]==1?$scope.data.security.Users[userIndex].permissions-4:$scope.data.security.Users[userIndex].permissions+4;_context7.prev=3;_context7.next=6;return service.auth.grantRevokeUser($scope.data.currentFileOrFolder.uuid,$scope.data.security.Users[userIndex].user,permissions,false);case 6:$scope.data.security.Users[userIndex].permissions=angular.copy(permissions);permissions=undefined;$scope.data.security.Users[userIndex].securityArray[1]=Math.abs($scope.data.security.Users[userIndex].securityArray[1]-1);if($scope.data.security.Users[userIndex].permissions==0)$scope.data.security.Users.splice(userIndex,1);toaster.pop("success","","امنیت با موفقیت تغییر کرد .");_context7.next=16;break;case 13:_context7.prev=13;_context7.t0=_context7['catch'](3);toaster.pop("error","","مشکلی در تغییر امنیت به وجود آمده است .");case 16:_context7.prev=16;_.defer(function(){return $scope.$apply();});return _context7.finish(16);case 19:_context7.next=22;break;case 21:toaster.pop('error',"","شما مجوز ویرایش دسترسی کاربران به این سند را ندارید.");case 22:_context7.next=27;break;case 24:_context7.prev=24;_context7.t1=_context7['catch'](0);console.error(_context7.t1);case 27:case'end':return _context7.stop();}}},_callee7,_this,[[0,24],[3,13,16,19]]);}));return function(_x6){return _ref7.apply(this,arguments);};}();$scope.func.toggleUserLock=function(){var _ref8=_asyncToGenerator(regeneratorRuntime.mark(function _callee8(userIndex){var permissions;return regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:_context8.prev=0;if(!$scope.data.currentFileOrFolder.permisionArray[0]){_context8.next=21;break;}permissions=$scope.data.security.Users[userIndex].securityArray[0]==1?$scope.data.security.Users[userIndex].permissions-8:$scope.data.security.Users[userIndex].permissions+8;_context8.prev=3;_context8.next=6;return service.auth.grantRevokeUser($scope.data.currentFileOrFolder.uuid,$scope.data.security.Users[userIndex].user,permissions,false);case 6:$scope.data.security.Users[userIndex].permissions=angular.copy(permissions);permissions=undefined;$scope.data.security.Users[userIndex].securityArray[0]=Math.abs($scope.data.security.Users[userIndex].securityArray[0]-1);if($scope.data.security.Users[userIndex].permissions==0)$scope.data.security.Users.splice(userIndex,1);toaster.pop("success","","امنیت با موفقیت تغییر کرد .");_context8.next=16;break;case 13:_context8.prev=13;_context8.t0=_context8['catch'](3);toaster.pop("error","","مشکلی در تغییر امنیت به وجود آمده است .");case 16:_context8.prev=16;_.defer(function(){return $scope.$apply();});return _context8.finish(16);case 19:_context8.next=22;break;case 21:toaster.pop('error',"","شما مجوز ویرایش دسترسی کاربران به این سند را ندارید.");case 22:_context8.next=27;break;case 24:_context8.prev=24;_context8.t1=_context8['catch'](0);console.error(_context8.t1);case 27:case'end':return _context8.stop();}}},_callee8,_this,[[0,24],[3,13,16,19]]);}));return function(_x7){return _ref8.apply(this,arguments);};}();$scope.func.updateRoles=_asyncToGenerator(regeneratorRuntime.mark(function _callee10(){return regeneratorRuntime.wrap(function _callee10$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:_context10.prev=0;if(!$scope.data.currentFileOrFolder.permisionArray[0]){_context10.next=11;break;}_context10.next=4;return JS.addJS('ecma5/ExternalLiberary/Desktop/updateSecurityRolesFunc.js?dev='+randomVersionName);case 4:_context10.next=6;return updateSecurityRolesFunc(uibModal,$scope.data.security.Roles,service,$scope.data.currentFileOrFolder.uuid);case 6:_context10.next=8;return JS.removeJS('ecma5/ExternalLiberary/Desktop/updateSecurityRolesFunc.js?dev='+randomVersionName,'updateSecurityRolesFunc');case 8:service.auth.listRole($scope.data.currentFileOrFolder.uuid).then(function(){var _ref10=_asyncToGenerator(regeneratorRuntime.mark(function _callee9(res){return regeneratorRuntime.wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:console.info(1);if(!(res.data!=null&&_.isArray(res.data))){_context9.next=11;break;}console.log(res.data);_context9.next=5;return JS.addJS('ecma5/ExternalLiberary/Public/getPermisionArray.js?dev='+randomVersionName);case 5:$scope.data.removeExternalFuncs['ecma5/ExternalLiberary/Public/getPermisionArray.js?dev='+randomVersionName]='getPermisionArray';_.forEach(res.data,function(v){return v.securityArray=getPermisionArray(v.permissions);});$scope.data.security.Roles=_.clone(res.data);_.remove($scope.data.security.Roles,function(role){return role.permissions==0;});_context9.next=12;break;case 11:$scope.data.security.Roles=null;case 12:_.defer(function(){return $scope.$apply();});case 13:case'end':return _context9.stop();}}},_callee9,_this);}));return function(_x8){return _ref10.apply(this,arguments);};}(),function(error){return toaster.pop('error','','عدم دریافت اطلاعات');});_context10.next=12;break;case 11:toaster.pop('error',"","شما مجوز ویرایش قوانین این سند را ندارید.");case 12:_context10.next=17;break;case 14:_context10.prev=14;_context10.t0=_context10['catch'](0);console.error(_context10.t0);case 17:case'end':return _context10.stop();}}},_callee10,_this,[[0,14]]);}));$scope.func.toggleRoleView=function(){var _ref11=_asyncToGenerator(regeneratorRuntime.mark(function _callee11(roleIndex){var permissions;return regeneratorRuntime.wrap(function _callee11$(_context11){while(1){switch(_context11.prev=_context11.next){case 0:_context11.prev=0;if(!$scope.data.currentFileOrFolder.permisionArray[0]){_context11.next=21;break;}permissions=$scope.data.security.Roles[roleIndex].securityArray[3]==1?$scope.data.security.Roles[roleIndex].permissions-1:$scope.data.security.Roles[roleIndex].permissions+1;_context11.prev=3;_context11.next=6;return service.auth.grantRevokeRole($scope.data.currentFileOrFolder.uuid,$scope.data.security.Roles[roleIndex].role,permissions,false);case 6:$scope.data.security.Roles[roleIndex].permissions=angular.copy(permissions);permissions=undefined;$scope.data.security.Roles[roleIndex].securityArray[3]=Math.abs($scope.data.security.Roles[roleIndex].securityArray[3]-1);if($scope.data.security.Roles[roleIndex].permissions==0)$scope.data.security.Roles.splice(roleIndex,1);toaster.pop("success","","امنیت با موفقیت تغییر کرد .");_context11.next=16;break;case 13:_context11.prev=13;_context11.t0=_context11['catch'](3);toaster.pop("error","","مشکلی در تغییر امنیت به وجود آمده است .");case 16:_context11.prev=16;_.defer(function(){return $scope.$apply();});return _context11.finish(16);case 19:_context11.next=22;break;case 21:toaster.pop('error',"","شما مجوز ویرایش دسترسی کاربران به این سند را ندارید.");case 22:_context11.next=27;break;case 24:_context11.prev=24;_context11.t1=_context11['catch'](0);console.error(_context11.t1);case 27:case'end':return _context11.stop();}}},_callee11,_this,[[0,24],[3,13,16,19]]);}));return function(_x9){return _ref11.apply(this,arguments);};}();$scope.func.toggleRoleEdit=function(){var _ref12=_asyncToGenerator(regeneratorRuntime.mark(function _callee12(roleIndex){var permissions;return regeneratorRuntime.wrap(function _callee12$(_context12){while(1){switch(_context12.prev=_context12.next){case 0:_context12.prev=0;if(!$scope.data.currentFileOrFolder.permisionArray[0]){_context12.next=21;break;}permissions=$scope.data.security.Roles[roleIndex].securityArray[2]==1?$scope.data.security.Roles[roleIndex].permissions-2:$scope.data.security.Roles[roleIndex].permissions+2;_context12.prev=3;_context12.next=6;return service.auth.grantRevokeRole($scope.data.currentFileOrFolder.uuid,$scope.data.security.Roles[roleIndex].role,permissions,false);case 6:$scope.data.security.Roles[roleIndex].permissions=angular.copy(permissions);permissions=undefined;$scope.data.security.Roles[roleIndex].securityArray[2]=Math.abs($scope.data.security.Roles[roleIndex].securityArray[2]-1);if($scope.data.security.Roles[roleIndex].permissions==0)$scope.data.security.Roles.splice(roleIndex,1);toaster.pop("success","","امنیت با موفقیت تغییر کرد .");_context12.next=16;break;case 13:_context12.prev=13;_context12.t0=_context12['catch'](3);toaster.pop("error","","مشکلی در تغییر امنیت به وجود آمده است .");case 16:_context12.prev=16;_.defer(function(){return $scope.$apply();});return _context12.finish(16);case 19:_context12.next=22;break;case 21:toaster.pop('error',"","شما مجوز ویرایش دسترسی کاربران به این سند را ندارید.");case 22:_context12.next=27;break;case 24:_context12.prev=24;_context12.t1=_context12['catch'](0);console.error(_context12.t1);case 27:case'end':return _context12.stop();}}},_callee12,_this,[[0,24],[3,13,16,19]]);}));return function(_x10){return _ref12.apply(this,arguments);};}();$scope.func.toggleRoleTrash=function(){var _ref13=_asyncToGenerator(regeneratorRuntime.mark(function _callee13(roleIndex){var permissions;return regeneratorRuntime.wrap(function _callee13$(_context13){while(1){switch(_context13.prev=_context13.next){case 0:_context13.prev=0;if(!$scope.data.currentFileOrFolder.permisionArray[0]){_context13.next=21;break;}permissions=$scope.data.security.Roles[roleIndex].securityArray[1]==1?$scope.data.security.Roles[roleIndex].permissions-4:$scope.data.security.Roles[roleIndex].permissions+4;_context13.prev=3;_context13.next=6;return service.auth.grantRevokeRole($scope.data.currentFileOrFolder.uuid,$scope.data.security.Roles[roleIndex].role,permissions,false);case 6:$scope.data.security.Roles[roleIndex].permissions=angular.copy(permissions);permissions=undefined;$scope.data.security.Roles[roleIndex].securityArray[1]=Math.abs($scope.data.security.Roles[roleIndex].securityArray[1]-1);if($scope.data.security.Roles[roleIndex].permissions==0)$scope.data.security.Roles.splice(roleIndex,1);toaster.pop("success","","امنیت با موفقیت تغییر کرد .");_context13.next=16;break;case 13:_context13.prev=13;_context13.t0=_context13['catch'](3);toaster.pop("error","","مشکلی در تغییر امنیت به وجود آمده است .");case 16:_context13.prev=16;_.defer(function(){return $scope.$apply();});return _context13.finish(16);case 19:_context13.next=22;break;case 21:toaster.pop('error',"","شما مجوز ویرایش دسترسی کاربران به این سند را ندارید.");case 22:_context13.next=27;break;case 24:_context13.prev=24;_context13.t1=_context13['catch'](0);console.error(_context13.t1);case 27:case'end':return _context13.stop();}}},_callee13,_this,[[0,24],[3,13,16,19]]);}));return function(_x11){return _ref13.apply(this,arguments);};}();$scope.func.toggleRoleLock=function(){var _ref14=_asyncToGenerator(regeneratorRuntime.mark(function _callee14(roleIndex){var permissions;return regeneratorRuntime.wrap(function _callee14$(_context14){while(1){switch(_context14.prev=_context14.next){case 0:_context14.prev=0;if(!$scope.data.currentFileOrFolder.permisionArray[0]){_context14.next=21;break;}permissions=$scope.data.security.Roles[roleIndex].securityArray[0]==1?$scope.data.security.Roles[roleIndex].permissions-8:$scope.data.security.Roles[roleIndex].permissions+8;_context14.prev=3;_context14.next=6;return service.auth.grantRevokeRole($scope.data.currentFileOrFolder.uuid,$scope.data.security.Roles[roleIndex].role,permissions,false);case 6:$scope.data.security.Roles[roleIndex].permissions=angular.copy(permissions);permissions=undefined;$scope.data.security.Roles[roleIndex].securityArray[0]=Math.abs($scope.data.security.Roles[roleIndex].securityArray[0]-1);if($scope.data.security.Roles[roleIndex].permissions==0)$scope.data.security.Roles.splice(roleIndex,1);toaster.pop("success","","امنیت با موفقیت تغییر کرد .");_context14.next=16;break;case 13:_context14.prev=13;_context14.t0=_context14['catch'](3);toaster.pop("error","","مشکلی در تغییر امنیت به وجود آمده است .");case 16:_context14.prev=16;_.defer(function(){return $scope.$apply();});return _context14.finish(16);case 19:_context14.next=22;break;case 21:toaster.pop('error',"","شما مجوز ویرایش دسترسی کاربران به این سند را ندارید.");case 22:_context14.next=27;break;case 24:_context14.prev=24;_context14.t1=_context14['catch'](0);console.error(_context14.t1);case 27:case'end':return _context14.stop();}}},_callee14,_this,[[0,24],[3,13,16,19]]);}));return function(_x12){return _ref14.apply(this,arguments);};}();/***************************************************************************************//*                                                                                     *//*                                   KEYWORD FUNCTIONS                                 *//*                                                                                     *//***************************************************************************************/$scope.func.addKeyword=function(form){try{if(_.has(form['keyword'],'$setTouched'))form['keyword'].$setTouched();if(form['keyword'].$valid==true){var index=_.findIndex($scope.data.currentFileOrFolder.keywords,function(Keyword){return Keyword==$scope.data.Keyword.data;});if(index<0){service.property.addKeyword($scope.data.currentFileOrFolder.uuid,$scope.data.Keyword.data).then(function(res){$scope.data.currentFileOrFolder.keywords.push($scope.data.Keyword.data);$scope.data.Keyword.data=null;toaster.pop('success','','کلید واژه جدید افزوده شد');_.defer(function(){return $scope.$apply();});},function(error){toaster.pop('error','','امکان افزودن کلید واژه جدید وجود ندارد');_.defer(function(){return $scope.$apply();});});}else{toaster.pop('warning','','این کلید واژه قبلا ثبت شده است');$scope.func.animate('#KeyWordsDoc-'+index);}}else{toaster.pop("error","","کلیدواژه ورودی صحیح نمی باشد.");_.defer(function(){return $scope.$apply();});}}catch(e){console.error(e);}};$scope.func.deleteKeyword=function(){var _ref15=_asyncToGenerator(regeneratorRuntime.mark(function _callee15(index){var response;return regeneratorRuntime.wrap(function _callee15$(_context15){while(1){switch(_context15.prev=_context15.next){case 0:_context15.prev=0;_context15.next=3;return JSManagement.addJS('ecma5/ExternalLiberary/Desktop/deleteSelectedKeyword.js?dev='+randomVersionName);case 3:_context15.next=5;return deleteSelectedKeywordCtrl(uibModal);case 5:response=_context15.sent;if(response==true){service.property.removeKeyword($scope.data.currentFileOrFolder.uuid,$scope.data.currentFileOrFolder.keywords[index]).then(function(res){$scope.data.currentFileOrFolder.keywords.splice(index,1);toaster.pop('success','','کلید واژه با موفقیت حذف شد');},function(error){return toaster.pop('error','','امکان حذف این کلید واژه نیست');});}_context15.next=9;return JSManagement.removeJS('ecma5/ExternalLiberary/Desktop/deleteSelectedKeyword.js?dev='+randomVersionName,'deleteSelectedKeywordCtrl');case 9:_context15.next=14;break;case 11:_context15.prev=11;_context15.t0=_context15['catch'](0);console.error(_context15.t0);case 14:case'end':return _context15.stop();}}},_callee15,_this,[[0,11]]);}));return function(_x13){return _ref15.apply(this,arguments);};}();$scope.func.showThesaurusTree=_asyncToGenerator(regeneratorRuntime.mark(function _callee17(){return regeneratorRuntime.wrap(function _callee17$(_context17){while(1){switch(_context17.prev=_context17.next){case 0:_context17.prev=0;return _context17.delegateYield(regeneratorRuntime.mark(function _callee16(){var response,index;return regeneratorRuntime.wrap(function _callee16$(_context16){while(1){switch(_context16.prev=_context16.next){case 0:_context16.next=2;return JSManagement.addJS('ecma5/ExternalLiberary/Public/selectThesaurusChild.js?dev='+randomVersionName);case 2:$scope.data.removeExternalFuncs['ecma5/ExternalLiberary/Public/selectThesaurusChild.js?dev='+randomVersionName]='selectThesaurusChild';_context16.next=5;return JSManagement.addJS('ecma5/ExternalLiberary/Public/getNameFromPath.js?dev='+randomVersionName);case 5:$scope.data.removeExternalFuncs['ecma5/ExternalLiberary/Public/getNameFromPath.js?dev='+randomVersionName]='getNameFromPath';_context16.next=8;return selectThesaurusChild(uibModal,//modal func
service.repository,//repository service
'getThesaurusFolder',// rootPath
service.folder,// folder service
"thesaurus",getNameFromPath);case 8:response=_context16.sent;if(_.has(response,'addNode')&&!_.isEmpty(response.addNode)){index=_.findIndex($scope.data.currentFileOrFolder.keywords,function(Keyword){return Keyword==response.addNode.label;});if(index<0){service.property.addKeyword($scope.data.selectedFileOrFolder.uuid,response.addNode.label).then(function(res){$scope.data.currentFileOrFolder.keywords.push(response.addNode.label);toaster.pop('success','','کلید واژه جدید افزوده شد');},function(error){return toaster.pop('error','','امکان افزودن کلید واژه جدید وجود ندارد');});}else{toaster.pop('error','','این کلید واژه قبلا ثبت شده است');$scope.func.animate('#KeyWordsDoc-'+index);}}case 10:case'end':return _context16.stop();}}},_callee16,_this);})(),'t0',2);case 2:_context17.next=7;break;case 4:_context17.prev=4;_context17.t1=_context17['catch'](0);console.error(_context17.t1);case 7:case'end':return _context17.stop();}}},_callee17,_this,[[0,4]]);}));/***************************************************************************************//*                                                                                     *//*                                   NOTES FUNCTIONS                                   *//*                                                                                     *//***************************************************************************************/$scope.func.noteCancel=function(){try{$scope.data.note={data:null,isActive:-1};_.defer(function(){return $scope.$apply();});}catch(e){console.error(e);}};$scope.func.editOrCreateNote=function(){try{console.log($scope.data.currentFileOrFolder.notes);if(!_.includes([null,''],$scope.data.note.data)){if($scope.data.note.isActive==-1)service.note.create($scope.data.currentFileOrFolder.uuid,$scope.data.note.data).then(function(){var _ref17=_asyncToGenerator(regeneratorRuntime.mark(function _callee18(res){return regeneratorRuntime.wrap(function _callee18$(_context18){while(1){switch(_context18.prev=_context18.next){case 0:_context18.next=2;return JS.addJS('ecma5/ExternalLiberary/Search/miladiToJalaliFunction.js?dev='+randomVersionName);case 2:$scope.data.removeExternalFuncs['ecma5/ExternalLiberary/Search/miladiToJalaliFunction.js?dev='+randomVersionName]='miladiToJalaliFunction';_context18.next=5;return miladiToJalaliFunction(res.data.note.date);case 5:res.data.note.jalaliDate=_context18.sent;$scope.data.currentFileOrFolder.notes.push(res.data.note);$scope.data.note.isActive=res.data.note.path;toaster.pop('success','','یادداشت با موفقیت اضافه گردید');_.defer(function(){return $scope.$apply();});case 10:case'end':return _context18.stop();}}},_callee18,_this);}));return function(_x14){return _ref17.apply(this,arguments);};}(),function(error){return toaster.pop('error','','امکان افزودن یادداشت جدید نیست');});else service.note.edit($scope.data.note.isActive,$scope.data.note.data).then(function(res){var index=_.findIndex($scope.data.currentFileOrFolder.notes,function(noteItem){return $scope.data.note.isActive==noteItem.path;});if(index>=0)$scope.data.currentFileOrFolder.notes[index].text=_.clone(res.data.config.data);toaster.pop('success','','یادداشت با موفقیت اضافه گردید');_.defer(function(){return $scope.$apply();});},function(error){return toaster.pop('error','','امکان ویرایش یادداشت جدید نیست');});}else toaster.pop('error','','لطفا یک عبارت وارد کنید');}catch(e){console.error(e);}};$scope.func.removeNote=function(){var _ref18=_asyncToGenerator(regeneratorRuntime.mark(function _callee19(note){var response;return regeneratorRuntime.wrap(function _callee19$(_context19){while(1){switch(_context19.prev=_context19.next){case 0:_context19.prev=0;_context19.next=3;return JS.addJS('ecma5/ExternalLiberary/Desktop/deleteSelectedNote.js?dev='+randomVersionName);case 3:_context19.next=5;return deleteSelectedNoteCtrl(uibModal);case 5:response=_context19.sent;if(response){service.note.delete(note.path).then(function(res){_.remove($scope.data.currentFileOrFolder.notes,function(n){return n.path==note.path;});if(note.path==$scope.data.note.isActive)$scope.data.note={data:null,action:'create',isActive:-1};toaster.pop('success','','یادداشت با موفقیت حذف گردید');_.defer(function(){return $scope.$apply();});},function(error){return toaster.pop('error','','امکان حذف این یادداشت نیست');});}_context19.next=9;return JS.removeJS('ecma5/ExternalLiberary/Public/deleteSelectedNote.js?dev='+randomVersionName,'deleteSelectedNoteCtrl');case 9:_context19.next=14;break;case 11:_context19.prev=11;_context19.t0=_context19['catch'](0);console.error(_context19.t0);case 14:case'end':return _context19.stop();}}},_callee19,_this,[[0,11]]);}));return function(_x15){return _ref18.apply(this,arguments);};}();$scope.func.editNote=function(note){try{$scope.data.note={data:_.clone(note.text),action:'edit',isActive:_.clone(note.path)};_.defer(function(){return $scope.$apply();});}catch(e){console.error(e);}};$scope.func.noteCancel=function(){try{$scope.data.note={data:null,isActive:-1};_.defer(function(){return $scope.$apply();});}catch(e){console.error(e);}};/***************************************************************************************//*                                                                                     *//*                                   ANIMATION FUNCTIONS                               *//*                                                                                     *//***************************************************************************************/$scope.func.animate=function(id){$(id).animate({color:'red',opacity:'0.2'}).animate({color:'black',opacity:'1'},"fast",function(){});};/***************************************************************************************//*                                                                                     *//*                                   METADATA FUNCTIONS                                *//*                                                                                     *//***************************************************************************************/$scope.func.removeMetaData=_asyncToGenerator(regeneratorRuntime.mark(function _callee20(){return regeneratorRuntime.wrap(function _callee20$(_context20){while(1){switch(_context20.prev=_context20.next){case 0:_context20.prev=0;_context20.next=3;return JS.addJS('ecma5/ExternalLiberary/Public/deleteRequest.js?dev='+randomVersionName);case 3:_context20.next=5;return deleteRequestCtrl(uibModal);case 5:$scope.data.removeExternalFuncs['ecma5/ExternalLiberary/Public/deleteRequest.js?dev='+randomVersionName]='deleteRequestCtrl';service.PropertyGroup.remove($scope.data.currentFileOrFolder.path,$scope.data.group.name).then(function(res){$scope.data.propertyGroupSelected=null;$scope.data.clonePropertyGroupSelected=null;try{if(_.isFunction($scope.externalScopeFill.InitializationForm))$scope.externalScopeFill.InitializationForm(null,{});}catch(e){console.error(e);}toaster.pop('success','','فراداده با موفقیت حذف گردید');_.defer(function(){return $scope.$apply();});},function(error){return toaster.pop('error','','عدم حذف موفق فراداده');});_context20.next=12;break;case 9:_context20.prev=9;_context20.t0=_context20['catch'](0);console.error(_context20.t0);case 12:case'end':return _context20.stop();}}},_callee20,_this,[[0,9]]);}));$scope.func.getMetadataList=function(){return new Promise(function(resolve,reject){if($scope.data.metadatas!=null)resolve($scope.data.metadatas);else{service.PropertyGroup.list().then(function(pgres){if(pgres.data!=null){_.forEach(pgres.data,function(pg){return pg.isSaved=true;});$scope.data.metadatas=_.clone(pgres.data);resolve($scope.data.metadatas);}},function(error){return reject(error);});}});};$scope.func.changeMetaData=function(){try{service.PropertyGroup.getGroups($scope.data.currentFileOrFolder.path,$scope.data.group).then(function(resIn){resIn.data.isSaved=false;resIn.data.isMetaData=true;resIn.data.type='FOLDER';$scope.data.propertyGroupSelected=angular.copy(resIn.data);$scope.data.clonePropertyGroupSelected=angular.copy(resIn.data);$scope.externalScopeFill.InitializationForm(null,{});_.defer(function(){$scope.externalScopeFill.InitializationForm(angular.copy(resIn.data.properties),{service:service,require:true});},1000);},function(error){return toaster.pop('error','','عدم دریافت اطلاعات');});}catch(e){console.error(e);}};$scope.func.editMetadataWithPromise=function(CloneProperties,form){return new Promise(function(resolve,reject){try{var error=false;var keys=_.keys(CloneProperties);if(_.has(form.$error,'pattern')&&_.isArray(form.$error.pattern)&&form.$error.pattern.length>0)reject('لطفا الگوهای درست وارد کنید');if(_.has(form.$error,'required')&&_.isArray(form.$error.required)&&form.$error.required.length>0){if(form.$invalid){_.forEach(form.$error,function(field){_.forEach(field,function(errorField){return errorField.$setTouched();});});}reject('لطفا فیلد های اجباری را پر کنید');}for(var i=0;i<keys.length;i++){if(_.has(form[keys[i]],'$setTouched'))form[keys[i]].$setTouched();if(typeof form[keys[i]]!=="undefined"&&_.has(form[keys[i]],'$error')&&!_.isEqual(form[keys[i]].$error,{}))error=true;}$scope.data.propertyGroupSelected.properties;if(!error){var _loop=function _loop(_i){var name=$scope.data.propertyGroupSelected.properties[_i].name;switch(CloneProperties[name].objClass){case'com.openkm.bean.form.Input':if(_.has($scope.data.propertyGroupSelected.properties[_i],'type'))switch($scope.data.propertyGroupSelected.properties[_i].type){case'date':if(_.isDate(CloneProperties[name].value)){try{var tempDate=_.clone(CloneProperties[name].value);$scope.data.PropertyGroup.properties[_i].value=''+String(tempDate.getFullYear())+(String(date.getMonth()+1).length==1?"0"+String(tempDate.getMonth()+1):String(tempDate.getMonth()+1))+(String(tempDate.getDate()).length==1?"0"+String(tempDate.getDate()):String(tempDate.getDate()))+(String(tempDate.getHours()).length==1?"0"+String(tempDate.getHours()):String(tempDate.getHours()))+(String(tempDate.getMinutes()).length==1?"0"+String(tempDate.getMinutes()):String(tempDate.getMinutes()))+(String(tempDate.getSeconds()).length==1?"0"+String(tempDate.getSeconds()):String(tempDate.getSeconds()));}catch(e){console.error(e);$scope.data.PropertyGroup.properties[_i].value=CloneProperties[name].value.toISOString();}}//$scope.data.propertyGroupSelected.properties[i].value = CloneProperties[name].value.toISOString();
break;case'text':case'number':case'email':case'link':$scope.data.propertyGroupSelected.properties[_i].value=_.clone(CloneProperties[name].value);break;}break;case'com.openkm.bean.form.Select':if(_.has($scope.data.propertyGroupSelected.properties[_i],'type')){if(!_.isArray($scope.data.propertyGroupSelected.properties[_i].options)){if($scope.data.propertyGroupSelected.properties[_i].options!=null)$scope.data.propertyGroupSelected.properties[_i].options=[$scope.data.propertyGroupSelected.properties[_i].options];else $scope.data.propertyGroupSelected.properties[_i].options=[];}switch($scope.data.propertyGroupSelected.properties[_i].type){case'simple':try{_.map($scope.data.propertyGroupSelected.properties[_i].options,function(option){return option.selected=false;});if(CloneProperties[name].selected!=null){var index=_.findIndex($scope.data.propertyGroupSelected.properties[_i].options,function(option){return option.value==CloneProperties[name].selected.value;});if(index>=0)$scope.data.propertyGroupSelected.properties[_i].options[index].selected=true;}}catch(e){console.error(e);}break;case'multiple':try{(function(){var selectedValues=_.map(CloneProperties[name].selected,'value');_.map($scope.data.propertyGroupSelected.properties[_i].options,function(option){return option.selected=_.includes(selectedValues,option.value);});})();}catch(e){console.error(e);}break;}}break;case'com.openkm.bean.form.TextArea':case'com.openkm.bean.form.CheckBox':$scope.data.propertyGroupSelected.properties[_i].value=_.clone(CloneProperties[name].value);break;}};for(var _i=0;_i<$scope.data.propertyGroupSelected.properties.length;_i++){_loop(_i);}var properties=angular.copy($scope.data.propertyGroupSelected.properties);_.forEach(properties,function(property){if(property.objClass=="com.openkm.bean.form.Select"&&_.has(property,'options')&&_.isArray(property.options)&&property.options.length==1)property.options=property.options[0];});service.PropertyGroup.formElement($scope.data.currentFileOrFolder.uuid,$scope.data.group.name,{formElementsComplex:{formElementComplex:[properties]}}).then(function(res){resolve('فراداده با موفقیت تغییر کرد.');service.PropertyGroup.getGroups($scope.data.currentFileOrFolder.uuid,$scope.data.group).then(function(resIn){$scope.data.propertyGroupSelected.properties=angular.copy(resIn.data.properties);if(_.isFunction($scope.externalScopeFill.InitializationForm)){$scope.externalScopeFill.InitializationForm(null,{});_.defer(function(){$scope.externalScopeFill.InitializationForm(angular.copy($scope.data.propertyGroupSelected.properties),{service:service,require:true,classSpliter:'col-sm-12'});},10);}},function(error){return toaster.pop('error','','عدم دریافت اطلاعات');});},function(error){return reject('عدم ذخیره موفق داده');});}else reject('فیلد های اجباری را پر کنید.');}catch(e){console.error(e);reject(e||e.message);}});};$scope.func.editMetaData=function(){var _ref20=_asyncToGenerator(regeneratorRuntime.mark(function _callee21(CloneProperties,form){var result;return regeneratorRuntime.wrap(function _callee21$(_context21){while(1){switch(_context21.prev=_context21.next){case 0:_context21.prev=0;_context21.next=3;return $scope.func.editMetadataWithPromise(CloneProperties,form);case 3:result=_context21.sent;toaster.pop('success','',result);_context21.next=10;break;case 7:_context21.prev=7;_context21.t0=_context21['catch'](0);toaster.pop('error','',_context21.t0||_context21.t0.message);case 10:_context21.prev=10;_.defer(function(){return $scope.$apply();});return _context21.finish(10);case 13:case'end':return _context21.stop();}}},_callee21,_this,[[0,7,10,13]]);}));return function(_x16,_x17){return _ref20.apply(this,arguments);};}();/***************************************************************************************//*                                                                                     *//*                                   CLICK & DBCLICK FUNCTIONS                         *//*                                                                                     *//***************************************************************************************/$scope.func.clickImage=function(e,doc){$scope.data.dbClicked=e.detail||e.originalEvent.detail;$scope.data.selectedFileOrFolder=_.clone(doc);switch($scope.data.dbClicked){case 1:/* TODO click in image */setTimeout(function(){if($scope.data.dbClicked==1){$scope.data.dbClicked=0;$scope.func.clickOccur(doc);}},500);break;case 2:/* TODO double click in image */$scope.func.dbClickOccur(doc);break;default:break;}};$scope.func.clickOccur=function(){var _ref21=_asyncToGenerator(regeneratorRuntime.mark(function _callee22(doc){return regeneratorRuntime.wrap(function _callee22$(_context22){while(1){switch(_context22.prev=_context22.next){case 0:_context22.next=2;return $scope.func.stopAllOldTasks();case 2:$scope.data.selectedUuid=doc.uuid;if(doc.type=="document"){$scope.func.showFile(doc);}case 4:case'end':return _context22.stop();}}},_callee22,_this);}));return function(_x18){return _ref21.apply(this,arguments);};}();$scope.func.dbClickOccur=function(){var _ref22=_asyncToGenerator(regeneratorRuntime.mark(function _callee23(doc){var keys,i,key;return regeneratorRuntime.wrap(function _callee23$(_context23){while(1){switch(_context23.prev=_context23.next){case 0:_context23.prev=0;_context23.next=3;return $scope.func.stopAllOldTasks();case 3:$scope.data.isNewThumbnailsRequest=true;_context23.prev=4;try{keys=_.keys($scope.data.filesList);for(i=0;i<keys.length;i++){key=keys[i];if($scope.data.filesList[key].Upload!=null&&$scope.data.filesList[key].status=="Sending"){$scope.data.filesList[key].Upload.upload.abort();$scope.data.filesList[key].status="Error";}}$scope.data.filesList={};}catch(e){console.error(e);}//todo remove all players
_context23.next=8;return JS.addJS('ecma5/ExternalLiberary/Public/removeAllPlayers.js?dev='+randomVersionName);case 8:$scope.data.removeExternalFuncs['ecma5/ExternalLiberary/Public/removeAllPlayers.js?dev='+randomVersionName]='removeAllPlayers';try{removeAllPlayers();}catch(e){console.error(e);}$scope.func.getActivatedItem({type:doc.type,uuid:doc.uuid},{index:0});_context23.next=16;break;case 13:_context23.prev=13;_context23.t0=_context23['catch'](4);console.error(_context23.t0);case 16:_context23.next=21;break;case 18:_context23.prev=18;_context23.t1=_context23['catch'](0);console.error(_context23.t1);case 21:case'end':return _context23.stop();}}},_callee23,_this,[[0,18],[4,13]]);}));return function(_x19){return _ref22.apply(this,arguments);};}();$scope.func.ok=function(){$uibModalInstance.close(true);};$scope.func.stopAllOldTasks=function(){return new Promise(function(){var _ref23=_asyncToGenerator(regeneratorRuntime.mark(function _callee24(resolve,reject){return regeneratorRuntime.wrap(function _callee24$(_context24){while(1){switch(_context24.prev=_context24.next){case 0:_context24.prev=0;_context24.next=3;return JS.addJS('ecma5/ExternalLiberary/Public/removeAllPlayers.js?dev='+randomVersionName);case 3:$scope.data.removeExternalFuncs['ecma5/ExternalLiberary/Public/removeAllPlayers.js?dev='+randomVersionName]='removeAllPlayers';try{removeAllPlayers();}catch(e){console.error(e);}try{$scope.data.viewer.type=null;$scope.data.viewer.pdf.isOpenfileShower=false;$scope.data.Keyword={data:null};$scope.data.note={data:null,action:'create',isActive:-1};/*$scope.data.security = {
                                            Users: null,
                                            Roles: null
                                        };*/}catch(e){console.error(e);}finally{_.defer(function(){return $scope.$apply();});resolve(true);}_context24.next=11;break;case 8:_context24.prev=8;_context24.t0=_context24['catch'](0);resolve(true);case 11:case'end':return _context24.stop();}}},_callee24,_this,[[0,8]]);}));return function(_x20,_x21){return _ref23.apply(this,arguments);};}());};$scope.func.copyItem=function(){var _ref24=_asyncToGenerator(regeneratorRuntime.mark(function _callee25(sendItem){var item;return regeneratorRuntime.wrap(function _callee25$(_context25){while(1){switch(_context25.prev=_context25.next){case 0:_context25.prev=0;item=angular.copy(sendItem);if(_.has(item,'thumbnailSrc')){_context25.next=18;break;}if(!_.has(item,'type')){_context25.next=18;break;}_context25.t0=item.type;_context25.next=_context25.t0==='document'?7:_context25.t0==='folder'?15:18;break;case 7:_context25.next=9;return JS.addJS('ecma5/ExternalLiberary/Public/getSrcFromType.js?dev='+randomVersionName);case 9:$scope.data.removeExternalFuncs['ecma5/ExternalLiberary/Public/getSrcFromType.js?dev='+randomVersionName]='getSrcFromType';_context25.next=12;return $scope.func.getImageLocal(item);case 12:item.thumbnailSrc=_context25.sent;item.name=item.name;return _context25.abrupt('break',18);case 15:item.thumbnailSrc='../../../../static/image/folder'+(item.hasChildren?'s':'')+'.png';item.name=item.name;return _context25.abrupt('break',18);case 18:$scope.func.addToClipBoardResults(item,'COPY');_context25.next=24;break;case 21:_context25.prev=21;_context25.t1=_context25['catch'](0);console.error(_context25.t1);case 24:case'end':return _context25.stop();}}},_callee25,_this,[[0,21]]);}));return function(_x22){return _ref24.apply(this,arguments);};}();$scope.func.cutItem=function(){var _ref25=_asyncToGenerator(regeneratorRuntime.mark(function _callee26(sendItem){var item;return regeneratorRuntime.wrap(function _callee26$(_context26){while(1){switch(_context26.prev=_context26.next){case 0:_context26.prev=0;item=angular.copy(sendItem);if(_.has(item,'thumbnailSrc')){_context26.next=18;break;}if(!_.has(item,'type')){_context26.next=18;break;}_context26.next=6;return JS.addJS('ecma5/ExternalLiberary/Public/getSrcFromType.js?dev='+randomVersionName);case 6:$scope.data.removeExternalFuncs['ecma5/ExternalLiberary/Public/getSrcFromType.js?dev='+randomVersionName]='getSrcFromType';_context26.t0=item.type;_context26.next=_context26.t0==='document'?10:_context26.t0==='folder'?15:18;break;case 10:_context26.next=12;return $scope.func.getImageLocal(item);case 12:item.thumbnailSrc=_context26.sent;item.name=item.name;return _context26.abrupt('break',18);case 15:item.thumbnailSrc='../../../../static/image/folder'+(item.hasChildren?'s':'')+'.png';item.name=item.name;return _context26.abrupt('break',18);case 18:$scope.func.addToClipBoardResults(item,'CUT');_context26.next=24;break;case 21:_context26.prev=21;_context26.t1=_context26['catch'](0);console.error(_context26.t1);case 24:case'end':return _context26.stop();}}},_callee26,_this,[[0,21]]);}));return function(_x23){return _ref25.apply(this,arguments);};}();$scope.func.removeItem=function(){var _ref26=_asyncToGenerator(regeneratorRuntime.mark(function _callee27(sendItem){var item,isRemove;return regeneratorRuntime.wrap(function _callee27$(_context27){while(1){switch(_context27.prev=_context27.next){case 0:_context27.prev=0;item=angular.copy(sendItem);if(!_.has(item,'type')){_context27.next=80;break;}_context27.next=5;return JS.addJS('ecma5/ExternalLiberary/Public/getPermisionArray.js?dev='+randomVersionName);case 5:$scope.data.removeExternalFuncs['ecma5/ExternalLiberary/Public/getPermisionArray.js?dev='+randomVersionName]='getPermisionArray';isRemove=getPermisionArray(item.permissions);_context27.t0=item.type;_context27.next=_context27.t0==='document'?10:_context27.t0==='folder'?54:80;break;case 10:if(!isRemove[1]){_context27.next=52;break;}_context27.next=13;return JS.addJS('ecma5/ExternalLiberary/Desktop/deleteFile.js?dev='+randomVersionName);case 13:$scope.data.removeExternalFuncs['ecma5/ExternalLiberary/Desktop/deleteFile.js?dev='+randomVersionName]='deleteFileDesktopCtrl';_context27.prev=14;_context27.next=17;return deleteFileDesktopCtrl(uibModal);case 17:if(!($scope.data.selectedUuid!=null&&$scope.data.selectedUuid==item.uuid)){_context27.next=36;break;}_context27.prev=18;_context27.prev=19;_context27.next=22;return $scope.func.stopAllOldTasks();case 22:_context27.next=27;break;case 24:_context27.prev=24;_context27.t1=_context27['catch'](19);console.error(_context27.t1);case 27:_context27.prev=27;_.defer(function(){return $scope.$apply();});return _context27.finish(27);case 30:$scope.data.selectedUuid=null;_context27.next=36;break;case 33:_context27.prev=33;_context27.t2=_context27['catch'](18);console.error(_context27.t2);case 36:_context27.next=38;return service.document.remove(item.uuid);case 38:$scope.data.File.offset--;try{$scope.data.list[item.uuid]=undefined;delete $scope.data.list[item.uuid];}catch(e){}//_.remove($scope.data.list,l=>l.uuid==item.uuid);
toaster.pop('success',"","سند با موفقیت حذف گردید");_context27.next=47;break;case 43:_context27.prev=43;_context27.t3=_context27['catch'](14);console.error(_context27.t3);toaster.pop('error',"","مشکلی در حذف سند انتخابی به وجود آمده است.");case 47:_context27.prev=47;_.defer(function(){return $scope.$apply();});return _context27.finish(47);case 50:_context27.next=53;break;case 52:toaster.pop('error','',"شما امکان حذف این سند را ندارید.");case 53:return _context27.abrupt('break',80);case 54:if(!isRemove[1]){_context27.next=78;break;}_context27.next=57;return JS.addJS('ecma5/ExternalLiberary/Desktop/deleteFolder.js?dev='+randomVersionName);case 57:$scope.data.removeExternalFuncs['ecma5/ExternalLiberary/Desktop/deleteFolder.js?dev='+randomVersionName]='deleteFolderDesktopExternalCtrl';_context27.prev=58;_context27.next=61;return deleteFolderDesktopExternalCtrl(uibModal);case 61:if($scope.data.selectedUuid!=null&&$scope.data.selectedUuid==item.uuid){$scope.data.selectedUuid=null;}_context27.next=64;return service.folder.remove(item.uuid);case 64:$scope.data.Folder.offset--;try{$scope.data.list[item.uuid]=undefined;delete $scope.data.list[item.uuid];}catch(e){}//_.remove($scope.data.list,l=>l.uuid==item.uuid);
toaster.pop('success',"","پوشه با موفقیت حذف گردید");_context27.next=73;break;case 69:_context27.prev=69;_context27.t4=_context27['catch'](58);console.error(_context27.t4);toaster.pop('error',"","مشکلی در حذف پوشه انتخابی به وجود آمده است.");case 73:_context27.prev=73;_.defer(function(){return $scope.$apply();});return _context27.finish(73);case 76:_context27.next=79;break;case 78:toaster.pop('error',"","شما امکان حذف این پوشه را ندارید.");case 79:return _context27.abrupt('break',80);case 80:_context27.next=85;break;case 82:_context27.prev=82;_context27.t5=_context27['catch'](0);console.error(_context27.t5);case 85:case'end':return _context27.stop();}}},_callee27,_this,[[0,82],[14,43,47,50],[18,33],[19,24,27,30],[58,69,73,76]]);}));return function(_x24){return _ref26.apply(this,arguments);};}();$scope.func.addToClipBoardResults=function(){var _ref27=_asyncToGenerator(regeneratorRuntime.mark(function _callee28(item,type){var selectedResults;return regeneratorRuntime.wrap(function _callee28$(_context28){while(1){switch(_context28.prev=_context28.next){case 0:_context28.prev=0;_context28.prev=1;_context28.next=4;return getSelectedLocalStorage('clipBoardResults');case 4:selectedResults=_context28.sent;if(selectedResults==null)selectedResults={};selectedResults['TYPE']=type;if(_.has(selectedResults,item.uuid))toaster.pop('info','','این آیتم قبلا به لیست انتخابی اضافه شده است.');else{selectedResults[item.uuid]=_.clone(item);toaster.pop('success','','آیتم با موفقیت به لیست موقت افزوده شد.');}_context28.prev=8;_context28.next=11;return setSelectedLocalStorage(_.clone(selectedResults),'clipBoardResults');case 11:_context28.next=16;break;case 13:_context28.prev=13;_context28.t0=_context28['catch'](8);console.error(_context28.t0);case 16:selectedResults=undefined;_context28.next=22;break;case 19:_context28.prev=19;_context28.t1=_context28['catch'](1);console.error(_context28.t1);case 22:_context28.prev=22;_.defer(function(){return $scope.$apply();});return _context28.finish(22);case 25:_context28.next=30;break;case 27:_context28.prev=27;_context28.t2=_context28['catch'](0);console.error(_context28.t2);case 30:case'end':return _context28.stop();}}},_callee28,_this,[[0,27],[1,19,22,25],[8,13]]);}));return function(_x25,_x26){return _ref27.apply(this,arguments);};}();$scope.func.showFile=function(){var _ref28=_asyncToGenerator(regeneratorRuntime.mark(function _callee29(doc){var viewerType;return regeneratorRuntime.wrap(function _callee29$(_context29){while(1){switch(_context29.prev=_context29.next){case 0:_context29.prev=0;if(!(isCookieFunction("Authorization")!=null)){_context29.next=69;break;}_context29.prev=2;_context29.next=5;return $scope.func.stopAllOldTasks();case 5:_context29.next=10;break;case 7:_context29.prev=7;_context29.t0=_context29['catch'](2);console.error(_context29.t0);case 10:if(!$scope.data.profile.prfTab.prfDocument.previewVisible){_context29.next=67;break;}_context29.next=13;return JS.addJS('ecma5/ExternalLiberary/Public/getViewer.js?dev='+randomVersionName);case 13:$scope.data.removeExternalFuncs['ecma5/ExternalLiberary/Public/getViewer.js?dev='+randomVersionName]='getViewer,fileTypeFromViewerHashTable';viewerType=getViewer(doc.mimeType);//if (!$scope.data.profile.prfMisc.acrobatPluginPreview && !_.includes(['video', 'audio', 'flash'], viewerType))
if($scope.data.profile.prfMisc.acrobatPluginPreview&&viewerType=="image")viewerType='pdfjs';_context29.t1=viewerType;_context29.next=_context29.t1==="image"?19:_context29.t1==="pdfjs"?33:_context29.t1==="flash"?56:_context29.t1==="video"?56:_context29.t1==="audio"?56:_context29.t1==="html"?61:64;break;case 19:$scope.data.viewer.type="image";_context29.next=22;return CSS.addCSS('resource/styleSheet/ol.css?dev='+randomVersionName);case 22:$scope.data.removeExternalCSS['resource/styleSheet/ol.css?dev='+randomVersionName]=true;_context29.next=25;return JS.addJS('resource/javaScript/ol.js?dev='+randomVersionName);case 25:$scope.data.removeExternalFuncs['resource/javaScript/ol.js?dev='+randomVersionName]='ol';_context29.next=28;return JS.addJS('static/js/ol3-ext_interaction_transforminteraction.js?dev='+randomVersionName);case 28:$scope.data.removeExternalFuncs['static/js/ol3-ext_interaction_transforminteraction.js?dev='+randomVersionName]='';_.defer(function(){return $scope.$apply();});if(isCookieFunction("Authorization")==null){toaster.pop("warning","","لطفا ابتدا وارد سیستم شوید .");Authentication.backToLoign();}//if(doc.mimeType == 'image/tiff'){
try{_.defer(function(){$scope.data.viewer.image.func({doc:angular.copy(doc)});},100);}catch(e){console.error(e);}return _context29.abrupt('break',67);case 33:_context29.next=35;return CSS.addCSS('static/pdfDirectiveViewer/web/viewer.css?dev='+randomVersionName);case 35:$scope.data.removeExternalCSS['static/pdfDirectiveViewer/web/viewer.css?dev='+randomVersionName]=true;_context29.next=38;return JS.addJS('static/pdfDirectiveViewer/web/compatibility.min.js?dev='+randomVersionName);case 38:$scope.data.removeExternalFuncs['static/pdfDirectiveViewer/web/compatibility.min.js?dev='+randomVersionName]='PDFJS';_context29.next=41;return JS.addJS('static/pdfDirectiveViewer/web/l10n.min.js?dev='+randomVersionName);case 41:$scope.data.removeExternalFuncs['static/pdfDirectiveViewer/web/l10n.min.js?dev='+randomVersionName]='webL10n';_context29.next=44;return JS.addJS('static/pdfDirectiveViewer/build/pdf.min.js?dev='+randomVersionName);case 44:$scope.data.removeExternalFuncs['static/pdfDirectiveViewer/build/pdf.min.js?dev='+randomVersionName]='PDFJS';_context29.next=47;return JS.addJS('static/pdfDirectiveViewer/web/debugger.min.js?dev='+randomVersionName);case 47:$scope.data.removeExternalFuncs['static/pdfDirectiveViewer/web/debugger.min.js?dev='+randomVersionName]='FontInspector,StepperManager,Stepper,Stats,PDFBug';_context29.next=50;return JS.addJS('static/pdfDirectiveViewer/web/debugger.js?dev='+randomVersionName);case 50:$scope.data.removeExternalFuncs['static/pdfDirectiveViewer/web/debugger.js?dev='+randomVersionName]='FontInspector,StepperManager,Stepper,Stats,PDFBug';$scope.data.viewer.type="pdf";$scope.data.viewer.pdf.isOpenfileShower=true;$scope.data.viewer['pdf'].url='/KeydocPro/services/rest/convertor/topdf?uuid='+doc.uuid+'&authId='+decodeURIComponent(isCookieFunction("Authorization").replace('Bearer',''))+'&'+Date.parse(new Date());_.defer(function(){if(window.document.querySelector("#modal-pdf-viewer-parent  #modal-pdf-viewer-child  #key-doc-pro-pdf-shower-id")==null)angular.element(window.document.querySelector("#modal-pdf-viewer-parent  #modal-pdf-viewer-child")).append($compile('<key-doc-pro-pdf-shower  id="key-doc-pro-pdf-shower-id" change-url="data.viewer.pdf.changeURL" first-search = "data.viewer.pdf.firstSearch" path-url="data.viewer.pdf.url" show-file="data.viewer.pdf.isOpenfileShower" ></key-doc-pro-pdf-shower>')($scope));_.defer(function(){$scope.$apply();if(_.isFunction($scope.data.viewer.pdf.changeURL))$scope.data.viewer['pdf'].changeURL($scope.data.viewer['pdf'].url,$scope.data.viewer['pdf'].firstSearch);});},100);return _context29.abrupt('break',67);case 56:$scope.data.player={};$scope.data.viewer.type="media";$scope.data.viewer.media.type=viewerType;try{if(_.isFunction($scope.data.viewer['player'].func))$scope.data.viewer['player'].func({thumbnail:doc.thumbnailSrc,src:'/KeydocPro/services/rest/document/getContent?docId='+doc.uuid+'&authId='+decodeURIComponent(isCookieFunction("Authorization").replace('Bearer',''))+'&'+new Date().getTime(),type:/(audio)/.test(doc.mimeType)?'audio':'video',duration:undefined,guid:doc.uuid,service:service.document,tags:null,first:true},$scope.data.profile.MultiMediaTagPermit);}catch(e){console.error(e);}return _context29.abrupt('break',67);case 61:$scope.data.viewer.type="html";service.document.getContentWithAuth(doc.uuid).then(function(res){$scope.data.viewer['html'].content=res.data;_.defer(function(){return $scope.$apply();});},function(err){toaster.pop("error","","مشکلی در دریافت سند به وجود آمده است.");});return _context29.abrupt('break',67);case 64:toaster.pop("warning","","سند انتخابی قابلیت نمایش در این سامانه را ندارد .");toaster.pop("info","","لطفا سند انتخابی را دانلود کنید .");return _context29.abrupt('break',67);case 67:_context29.next=71;break;case 69:toaster("error","","لطفا ابتدا وارد سیستم شوید.");Authentication.backToLoign();case 71:_context29.next=76;break;case 73:_context29.prev=73;_context29.t2=_context29['catch'](0);console.error(_context29.t2);case 76:case'end':return _context29.stop();}}},_callee29,_this,[[0,73],[2,7]]);}));return function(_x27){return _ref28.apply(this,arguments);};}();$scope.func.getThumbnailFile=function(file,getSrcFromType){return new Promise(function(resolve,reject){try{service.document.thumbnail(file,0,75).then(function(result){return resolve("data:image/png;base64,"+result.data);},function(error){return resolve(getSrcFromType(file.mimeType));});}catch(e){console.error(e);resolve(getSrcFromType(file.mimeType));}});};$scope.func.getImage=function(){var _ref29=_asyncToGenerator(regeneratorRuntime.mark(function _callee30(id){return regeneratorRuntime.wrap(function _callee30$(_context30){while(1){switch(_context30.prev=_context30.next){case 0:_context30.prev=0;_context30.next=3;return JS.addJS('ecma5/ExternalLiberary/Public/getSrcFromType.js?dev='+randomVersionName);case 3:$scope.data.removeExternalFuncs['ecma5/ExternalLiberary/Public/getSrcFromType.js?dev='+randomVersionName]='getSrcFromType';if(!($scope.data.isNewThumbnailsRequest==true)){_context30.next=6;break;}throw new Error("Stopping get Thumbnail function!");case 6:_context30.prev=6;_context30.next=9;return $scope.func.getThumbnailFile($scope.data.list[id],getSrcFromType);case 9:$scope.data.list[id].thumbnailSrc=_context30.sent;_context30.next=15;break;case 12:_context30.prev=12;_context30.t0=_context30['catch'](6);console.error(_context30.t0);case 15:_context30.prev=15;$scope.data.list[id].notTumbnail=false;return _context30.finish(15);case 18:_.defer(function(){return $scope.$apply();});_context30.next=24;break;case 21:_context30.prev=21;_context30.t1=_context30['catch'](0);console.error(_context30.t1.message||_context30.t1);case 24:case'end':return _context30.stop();}}},_callee30,_this,[[0,21],[6,12,15,18]]);}));return function(_x28){return _ref29.apply(this,arguments);};}();$scope.func.getNameFromPath=function(path){return typeof path==="string"?path.split("/").pop():"";};$scope.func.goState=function(){var _ref30=_asyncToGenerator(regeneratorRuntime.mark(function _callee31(type){var key;return regeneratorRuntime.wrap(function _callee31$(_context31){while(1){switch(_context31.prev=_context31.next){case 0:_context31.prev=0;_context31.t0=$scope.data.state;_context31.next=_context31.t0==="view"?4:_context31.t0==="upload"?6:27;break;case 4:$scope.data.state=type;return _context31.abrupt('break',28);case 6:if(!(_.filter($scope.data.filesList,function(file){return file.status=='Sending';}).length>0)){_context31.next=11;break;}toaster.pop("error","","تا اتمام ارسال سند ها لطفا منتظر بمانید");return _context31.abrupt('return');case 11:_context31.t1=regeneratorRuntime.keys($scope.data.filesList);case 12:if((_context31.t2=_context31.t1()).done){_context31.next=25;break;}key=_context31.t2.value;if(!($scope.data.filesList[key].status=="Error")){_context31.next=23;break;}_context31.prev=15;_context31.next=18;return service.document.remove($scope.data.filesList[key].Upload.path);case 18:_context31.next=23;break;case 20:_context31.prev=20;_context31.t3=_context31['catch'](15);console.error(_context31.t3);case 23:_context31.next=12;break;case 25:/*try{
                                            $scope.data.Selectedfolder.fileCount += _.filter($scope.data.filesList , file => file.status == "Success").length;
                                        }catch(e){
                                            console.log(e);
                                        }finally{
                                            _.defer(()=>$scope.$apply());
                                        }*/$scope.data.state=type;case 26:return _context31.abrupt('break',28);case 27:return _context31.abrupt('break',28);case 28:_context31.next=33;break;case 30:_context31.prev=30;_context31.t4=_context31['catch'](0);console.error(_context31.t4);case 33:_context31.prev=33;_.defer(function(){return $scope.$apply();});return _context31.finish(33);case 36:case'end':return _context31.stop();}}},_callee31,_this,[[0,30,33,36],[15,20]]);}));return function(_x29){return _ref30.apply(this,arguments);};}();$scope.func.deleteMetaData=function(CloneProperties,form){};/***************************************************************************************//*                                                                                     *//*                                   UPLOAD FUNCTIONS                                  *//*                                                                                     *//***************************************************************************************/$scope.func.createCanvas=function(name){return new Promise(function(resolveTIFF,rejectTIFF){try{var c=document.createElement("canvas");c.width=120;c.height=80;var ctx=c.getContext("2d");ctx.clearRect(-500,-500,c.width+500,c.height+500);ctx.rect(0,0,c.width,c.height);// add linear gradient
var grd=ctx.createLinearGradient(0,0,c.width,c.height);// light blue
grd.addColorStop(1,'#8ED6FF');// dark blue
grd.addColorStop(0,'#004CB3');ctx.fillStyle=grd;ctx.fill();ctx.globalAlpha=1;ctx.fillStyle='#fff';ctx.font='30px arial,sans-serif';ctx.setTransform(1,0,0,1,25,10);ctx.fillText(name,10,40);resolveTIFF(c.toDataURL());}catch(e){resolveTIFF("./../../../static/backgrounds/1.jpg");}});};$scope.func.addFiles=function(files){_.forEach(files,function(){var _ref31=_asyncToGenerator(regeneratorRuntime.mark(function _callee32(file){var imageItem,reader;return regeneratorRuntime.wrap(function _callee32$(_context32){while(1){switch(_context32.prev=_context32.next){case 0:if(!(_.includes(_.map($scope.data.list,'name'),file.name)||$scope.data.filesList[file.name])){_context32.next=4;break;}toaster.pop('error','','سند '+file.name+' در این پوشه وجود دارد');_context32.next=42;break;case 4:if(!file.type.match('image.*')){_context32.next=36;break;}if(!(file.type=="image/tiff")){_context32.next=14;break;}imageItem={file:file,status:'New',Upload:null,isSelect:false,color:'#000'};_context32.next=9;return $scope.func.createCanvas(file.name.split(".").pop());case 9:imageItem.url=_context32.sent;$scope.data.filesList[file.name]=_.clone(imageItem);_.defer(function(){return $scope.$apply();});_context32.next=34;break;case 14:_context32.prev=14;if(!(file.size<=1500000)){_context32.next=21;break;}reader=new FileReader();reader.onload=function(img){$scope.data.filesList[file.name]={file:file,status:'New',Upload:null,isSelect:false,color:'#fff',url:img.target.result};_.defer(function(){return $scope.$apply();});};reader.readAsDataURL(file);_context32.next=27;break;case 21:imageItem={file:file,status:'New',Upload:null,isSelect:false,color:'#000'};_context32.next=24;return $scope.func.createCanvas(file.name.split(".").pop());case 24:imageItem.url=_context32.sent;$scope.data.filesList[file.name]=_.clone(imageItem);_.defer(function(){return $scope.$apply();});case 27:_context32.next=34;break;case 29:_context32.prev=29;_context32.t0=_context32['catch'](14);console.error(_context32.t0);$scope.data.filesList[file.name]={file:file,status:'New',Upload:null,isSelect:false,color:'#fff',url:"./../../../static/backgrounds/1.jpg"};_.defer(function(){return $scope.$apply();});case 34:_context32.next=42;break;case 36:imageItem={file:file,status:'New',Upload:null,isSelect:false,color:'#000'};_context32.next=39;return $scope.func.createCanvas(file.name.split(".").pop());case 39:imageItem.url=_context32.sent;$scope.data.filesList[file.name]=_.clone(imageItem);_.defer(function(){return $scope.$apply();});case 42:case'end':return _context32.stop();}}},_callee32,_this,[[14,29]]);}));return function(_x30){return _ref31.apply(this,arguments);};}());};$scope.func.convertTIFF2JPEG=function(img){return new Promise(function(resolveTIFF,rejectTIFF){try{var reader=new FileReader();reader.onerror=function(){return rejectTIFF(e);};reader.onload=function(e){Tiff.initialize({TOTAL_MEMORY:16777216*10});var tiff=new Tiff({buffer:e.target.result});var canvas=tiff.toCanvas();var newfile=$scope.func.dataURItoBlob(canvas.toDataURL("image/jpeg"),"image/jpeg");var readerFileCanvas=new FileReader();readerFileCanvas.onerror=function(){return rejectTIFF("عدم تبدیل فرمت tiff ");};readerFileCanvas.onload=function(evt){return resolveTIFF(evt.target.result);};readerFileCanvas.readAsDataURL(newfile);};reader.readAsArrayBuffer(img);}catch(e){console.error(e);rejectTIFF(e);}});};$scope.func.resizeFile=function(src){var imageObj=new Image();imageObj.onload=function(img){// Check for empty images
if(imageObj.width>0&&imageObj.height>0){var v=0;var h=0;if(imageObj.width>imageObj.height){v=150;h=imageObj.height/(imageObj.width/v);}else{h=150;v=imageObj.width/(imageObj.height/h);}var _canvas=document.createElement("canvas");_canvas.style.visibility="hidden";_canvas.width=v;_canvas.height=h;document.body.appendChild(_canvas);var context=_canvas.getContext("2d");context.clearRect(0,0,v,h);context.drawImage(imageObj,0,0,imageObj.width,imageObj.height,0,0,v,h);$scope.data.file=$scope.func.dataURItoBlob(_canvas.toDataURL("image/jpeg"),"image/jpeg");document.body.removeChild(_canvas);}};imageObj.onabort=function(){window.document.body.removeChild(canvas);};imageObj.onerror=function(){window.document.body.removeChild(canvas);};imageObj.src=src;};$scope.func.dataURItoBlob=function(dataURI,dataTYPE){try{var binary=atob(dataURI.split(',')[1]),array=[];for(var i=0;i<binary.length;i++){array.push(binary.charCodeAt(i));}return new Blob([new Uint8Array(array)],{type:dataTYPE});}catch(e){console.error(e);}};$scope.func.startUpload=_asyncToGenerator(regeneratorRuntime.mark(function _callee33(){var keys,i,name,result;return regeneratorRuntime.wrap(function _callee33$(_context33){while(1){switch(_context33.prev=_context33.next){case 0:if(!(isCookieFunction('Authorization')!=null)){_context33.next=24;break;}keys=_.keys($scope.data.filesList);i=0;case 3:if(!(i<keys.length)){_context33.next=22;break;}name=keys[i];if(!(_.has($scope.data.filesList,name)&&_.includes(["New","Error"],$scope.data.filesList[name].status))){_context33.next=19;break;}_context33.prev=6;_context33.next=9;return $scope.func.sendingFile2Server(name);case 9:result=_context33.sent;toaster.pop("success","",result);/*todo what work after successfully upload file **/_context33.next=16;break;case 13:_context33.prev=13;_context33.t0=_context33['catch'](6);toaster.pop("error","",_context33.t0||_context33.t0.message);case 16:_context33.prev=16;_.defer(function(){return $scope.$apply();});return _context33.finish(16);case 19:i++;_context33.next=3;break;case 22:_context33.next=26;break;case 24:toaster.pop("error","","لطفا ابتدا وارد سیستم شوید.");$scope.func.ok();case 26:case'end':return _context33.stop();}}},_callee33,_this,[[6,13,16,19]]);}));$scope.func.sendingFile2Server=function(name){return new Promise(function(resolve,reject){try{$scope.data.filesList[name].status="Sending";_.defer(function(){return $scope.$apply();});$scope.data.filesList[name].Upload={percent:0,filename:name,path:$scope.data.currentFileOrFolder.path+'/'+name,upload:$upload.upload({url:'/KeydocPro/services/rest/document/createSimple',data:{docPath:$scope.data.currentFileOrFolder.path+'/'+name,isSigned:$scope.data.filesList[name].isSelect,content:$scope.data.filesList[name].file,sizeOfFile:$scope.data.filesList[name].file.size},headers:{'Authorization':decodeURIComponent(_.replace(isCookieFunction("Authorization"),"Bearer","Bearer "))}}).progress(function(evt){_.defer(function(){return $scope.$apply($scope.data.filesList[name].Upload.percent=parseInt(100.0*evt.loaded/evt.total));});}).success(function(data,status,headers,config){$scope.data.filesList[name].status="Success";var v=angular.copy(data.document);v.name=$scope.func.getNameFromPath(v.path);v.type='document';v.mimeType=v.mimeType=='application/octet-stream'?$scope.func.getNameFromPath(v.name.split('.').pop()):v.mimeType;v.selected=false;v.thumbnailSrc=getSrcFromType(v.mimeType);$scope.data.list[v.id||v.uuid]=angular.copy(v);var id=angular.copy(v.id||v.uuid);v=undefined;try{$scope.func.getThumbnailFile(angular.copy($scope.data.list[id]),getSrcFromType).then(function(res){$scope.data.list[id].thumbnailSrc=res;_.defer(function(){return $scope.$apply();});},function(error){return console.error(error);});}catch(e){console.error(e);}resolve("سند "+name+" با موفقیت ارسال شد.");}).error(function(error){$scope.data.filesList[name].status="Error";reject("مشکلی در ارسال سند  "+name+" به سرور رخ داده است.");})};_.defer(function(){return $scope.$apply();});}catch(e){reject("مشکلی در ارسال سند  "+name+" به سرور رخ داده است.");}finally{_.defer(function(){return $scope.$apply();});}});};$scope.func.uploadAgain=function(){var _ref33=_asyncToGenerator(regeneratorRuntime.mark(function _callee34(key){var result;return regeneratorRuntime.wrap(function _callee34$(_context34){while(1){switch(_context34.prev=_context34.next){case 0:if(!(isCookieFunction('Authorization')!=null)){_context34.next=34;break;}_context34.prev=1;_.defer(function(){return $scope.$apply();});_context34.prev=3;_context34.next=6;return service.document.remove($scope.data.filesList[key].Upload.path);case 6:_context34.next=11;break;case 8:_context34.prev=8;_context34.t0=_context34['catch'](3);console.error(_context34.t0);case 11:$scope.data.filesList[key].Upload=undefined;delete $scope.data.filesList[key].Upload;_context34.prev=13;_context34.next=16;return $scope.func.sendingFile2Server(key);case 16:result=_context34.sent;toaster.pop("success","",result);_context34.next=23;break;case 20:_context34.prev=20;_context34.t1=_context34['catch'](13);toaster.pop("error","",_context34.t1||_context34.t1.message);case 23:_context34.prev=23;_.defer(function(){return $scope.$apply();});return _context34.finish(23);case 26:_.defer(function(){return $scope.$apply();});_context34.next=32;break;case 29:_context34.prev=29;_context34.t2=_context34['catch'](1);console.error(_context34.t2);case 32:_context34.next=36;break;case 34:toaster.pop("error","","لطفا ابتدا وارد سیستم شوید.");$scope.func.cancel();case 36:case'end':return _context34.stop();}}},_callee34,_this,[[1,29],[3,8],[13,20,23,26]]);}));return function(_x31){return _ref33.apply(this,arguments);};}();$scope.func.uploadFiles=function(){if(_.filter($scope.data.filesList,function(file){return file.status=='Sending';}).length>0)toaster.pop("error","","تا اتمام ارسال سند ها لطفا منتظر بمانید");else if(_.filter($scope.data.filesList,function(file){return _.includes(["New","Error"],file.status);}).length==0)toaster.pop('error','','لطفا حداقل یک سند جدید برای ارسال انتخاب کنید');else $scope.func.startUpload();};$scope.func.onCancelFileUpload=function(key){try{if($scope.data.filesList[key].Upload!=null&&$scope.data.filesList[key].status=="Sending"){$scope.data.filesList[key].Upload.upload.abort();$scope.data.filesList[key].status="Error";}}catch(e){console.error(e);}};$scope.func.onCancelFileClick=function(key){try{if(_.has($scope.data.filesList[key],'Upload')&&$scope.data.filesList[key].Upload!=null&&$scope.data.filesList[key].status=="Sending")$scope.data.filesList[key].Upload.upload.abort();$scope.data.filesList[key]=undefined;delete $scope.data.filesList[key];}catch(e){console.error(e);}};$scope.func.onDeleteItemClick=function(key){if($scope.data.filesList[key])$scope.func.onCancelFileClick(key);};$scope.func.onCancelAllFileUpload=function(){try{var keys=_.keys($scope.data.filesList);for(var i=0;i<keys.length;i++){var key=keys[i];if($scope.data.filesList[key].Upload!=null&&$scope.data.filesList[key].status=="Sending"){$scope.data.filesList[key].Upload.upload.abort();$scope.data.filesList[key].status="Error";}}}catch(e){console.error(e);}};/***************************************************************************************//*                                                                                     *//*                                   STATES FUNCTIONS                                  *//*                                                                                     *//***************************************************************************************/$scope.func.goState=function(){var _ref34=_asyncToGenerator(regeneratorRuntime.mark(function _callee35(type){var key;return regeneratorRuntime.wrap(function _callee35$(_context35){while(1){switch(_context35.prev=_context35.next){case 0:_context35.prev=0;_context35.t0=$scope.data.state;_context35.next=_context35.t0==="view"?4:_context35.t0==="upload"?6:27;break;case 4:$scope.data.state=type;return _context35.abrupt('break',28);case 6:if(!(_.filter($scope.data.filesList,function(file){return file.status=='Sending';}).length>0)){_context35.next=11;break;}toaster.pop("error","","تا اتمام ارسال سند ها لطفا منتظر بمانید");return _context35.abrupt('return');case 11:_context35.t1=regeneratorRuntime.keys($scope.data.filesList);case 12:if((_context35.t2=_context35.t1()).done){_context35.next=25;break;}key=_context35.t2.value;if(!($scope.data.filesList[key].status=="Error")){_context35.next=23;break;}_context35.prev=15;_context35.next=18;return service.document.remove($scope.data.filesList[key].Upload.path);case 18:_context35.next=23;break;case 20:_context35.prev=20;_context35.t3=_context35['catch'](15);console.error(_context35.t3);case 23:_context35.next=12;break;case 25:$scope.data.state=type;case 26:return _context35.abrupt('break',28);case 27:return _context35.abrupt('break',28);case 28:_context35.next=33;break;case 30:_context35.prev=30;_context35.t4=_context35['catch'](0);console.error(_context35.t4);case 33:_context35.prev=33;_.defer(function(){return $scope.$apply();});return _context35.finish(33);case 36:case'end':return _context35.stop();}}},_callee35,_this,[[0,30,33,36],[15,20]]);}));return function(_x32){return _ref34.apply(this,arguments);};}();/***************************************************************************************//*                                                                                     *//*                                   Breadcrumb FUNCTIONS                              *//*                                                                                     *//***************************************************************************************/$scope.func.selectBreadcrumb=function(index){try{if($scope.data.breadcrumbList[index].uuid!=$scope.data.activateItemUUID){$scope.data.breadcrumbList.splice(index+1);try{var keys=_.keys($scope.data.filesList);for(var i=0;i<keys.length;i++){var key=keys[i];if($scope.data.filesList[key].Upload!=null&&$scope.data.filesList[key].status=="Sending"){$scope.data.filesList[key].Upload.upload.abort();$scope.data.filesList[key].status="Error";}}$scope.data.filesList={};}catch(e){console.error(e);}$scope.func.goToFolder($scope.data.breadcrumbList[index]);}else toaster.pop("info","","این پوشه در حال حاظر انتخاب شده است.");}catch(e){console.error(e);}};$scope.func.goToFolder=function(){var _ref35=_asyncToGenerator(regeneratorRuntime.mark(function _callee36(folder,index){return regeneratorRuntime.wrap(function _callee36$(_context36){while(1){switch(_context36.prev=_context36.next){case 0:$scope.data.isNewThumbnailsRequest=true;_context36.prev=1;_context36.prev=2;_context36.next=5;return $scope.func.stopAllOldTasks();case 5:_context36.next=10;break;case 7:_context36.prev=7;_context36.t0=_context36['catch'](2);console.error(_context36.t0);case 10:$scope.func.getActivatedItem(folder,typeof index==="undefined"?{}:{index:index});_context36.next=16;break;case 13:_context36.prev=13;_context36.t1=_context36['catch'](1);console.error(_context36.t1);case 16:case'end':return _context36.stop();}}},_callee36,_this,[[1,13],[2,7]]);}));return function(_x33,_x34){return _ref35.apply(this,arguments);};}();/***************************************************************************************//*                                                                                     *//*                                   GEING FUNCTIONS                                   *//*                                                                                     *//***************************************************************************************/$scope.func.run=function(){var _ref36=_asyncToGenerator(regeneratorRuntime.mark(function _callee38(doing){var cloneData,childs;return regeneratorRuntime.wrap(function _callee38$(_context38){while(1){switch(_context38.prev=_context38.next){case 0:_context38.prev=0;$scope.data.isNewThumbnailsRequest=true;_context38.next=4;return JS.addJS('ecma5/ExternalLiberary/Public/getSrcFromType.js?dev='+randomVersionName);case 4:$scope.data.removeExternalFuncs['ecma5/ExternalLiberary/Public/getSrcFromType.js?dev='+randomVersionName]='getSrcFromType';if(_.has(doing,'index')){cloneData=angular.copy($scope.data.currentFileOrFolder);$scope.data.breadcrumbList.push({label:$scope.data.currentFileOrFolder.label,uuid:$scope.data.currentFileOrFolder.uuid,type:$scope.data.currentFileOrFolder.type});cloneData=undefined;}$scope.data.propertyGroupSelected=null;$scope.data.clonePropertyGroupSelected=null;$scope.data.activateItemUUID=angular.copy($scope.data.currentFileOrFolder.uuid);$scope.data.list=undefined;$scope.data.list={};childs=null;$scope.data.security={Users:null,Roles:null};if($scope.data.currentFileOrFolder.type=='folder'){$scope.func.showLeftItem($scope.data.navigation.activatedIcon,true);service.PropertyGroup.listGroup($scope.data.currentFileOrFolder.path).then(function(){var _ref37=_asyncToGenerator(regeneratorRuntime.mark(function _callee37(res){return regeneratorRuntime.wrap(function _callee37$(_context37){while(1){switch(_context37.prev=_context37.next){case 0:$scope.data.group=_.has(res.data,'list')&&res.data.list!=null?_.isArray(res.data.list)?angular.copy(res.data.list[0]):angular.copy(res.data.list):null;if($scope.data.group!=null){_.defer(function(){service.PropertyGroup.getGroups($scope.data.currentFileOrFolder.path,$scope.data.group).then(function(resIn){if(_.isFunction($scope.externalScopeFill.InitializationForm)){$scope.data.propertyGroupSelected=angular.copy(resIn.data);$scope.data.clonePropertyGroupSelected=angular.copy(resIn.data);$scope.externalScopeFill.InitializationForm(null,{});_.defer(function(){$scope.externalScopeFill.InitializationForm(angular.copy(resIn.data.properties),{service:service,require:true});},1000);}},function(error){return toaster.pop('error','','عدم دریافت اطلاعات');});},500);}else{try{if(_.isFunction($scope.externalScopeFill.InitializationForm))$scope.externalScopeFill.InitializationForm(null,{});}catch(e){console.error(e);}}_context37.prev=2;_context37.next=5;return service.repository.getCountChildren($scope.data.currentFileOrFolder.uuid);case 5:childs=_context37.sent;$scope.data.Folder={count:childs.data.originalElement.Folders,offset:0,limit:5,remaind:childs.data.originalElement.Folders};$scope.data.File={count:childs.data.originalElement.Documents,offset:0,limit:5,remaind:childs.data.originalElement.Documents};_context37.next=13;break;case 10:_context37.prev=10;_context37.t0=_context37['catch'](2);console.error(_context37.t0);case 13:if($scope.data.notConfig){$scope.data.notConfig=false;$("div.thumbnails div#view-thumbnails").scroll(function(){if($("div.thumbnails div#view-thumbnails").prop('scrollHeight')-$("div.thumbnails div#view-thumbnails").scrollTop()<=$("div.thumbnails div#view-thumbnails").height()+20){if($scope.data.isRunScrollFunc==true)return;$scope.data.isRunScrollFunc=true;_.defer(function(){$scope.func.getChilds();},1000);}});}$scope.data.minimize.right=false;$scope.func.getChilds();_.defer(function(){return $scope.$apply();});case 17:case'end':return _context37.stop();}}},_callee37,_this,[[2,10]]);}));return function(_x36){return _ref37.apply(this,arguments);};}(),function(err){try{if(_.isFunction($scope.externalScopeFill.InitializationForm))$scope.externalScopeFill.InitializationForm(null,{});}catch(e){console.error(e);}finally{console.error(err);_.defer(function(){return $scope.$apply();});}});}else{/*todo type is document */$scope.data.minimize.right=true;$scope.func.showFile($scope.data.currentFileOrFolder);if($scope.data.navigation.activatedIcon!='metadata'){$scope.func.showLeftItem($scope.data.navigation.activatedIcon,true);/*$scope.data.navigation = {
                                        activatedIcon : null,
                                        header        : 'لطفا از منو یک آیتم را انتخاب کنید.'
                                    };
                                    $scope.data.minimize.left = true;*/}else{$scope.data.minimize.left=true;}_.defer(function(){return $scope.$apply();});}_context38.next=19;break;case 16:_context38.prev=16;_context38.t0=_context38['catch'](0);console.error(_context38.t0);case 19:case'end':return _context38.stop();}}},_callee38,_this,[[0,16]]);}));return function(_x35){return _ref36.apply(this,arguments);};}();$scope.func.getChilds=function(){try{$scope.data.isNewThumbnailsRequest=false;if($scope.data.Folder.remaind>0){service.folder.sectionChild($scope.data.currentFileOrFolder.uuid,$scope.data.Folder.offset,$scope.data.Folder.limit).then(function(){var _ref38=_asyncToGenerator(regeneratorRuntime.mark(function _callee39(result){var getFolderCounts;return regeneratorRuntime.wrap(function _callee39$(_context39){while(1){switch(_context39.prev=_context39.next){case 0:$scope.data.Folder.offset+=$scope.data.Folder.limit;$scope.data.Folder.remaind-=$scope.data.Folder.limit;if(result.data!=null){getFolderCounts=0;if(!_.isArray(result.data)&&_.has(result.data,'originalElement')){if(_.has(result.data.originalElement,'folders')&&result.data.originalElement.folders!=""){if(_.has(result.data.originalElement.folders,'folder')&&_.isArray(result.data.originalElement.folders.folder))result.data=result.data.originalElement.folders.folder;else if(_.has(result.data.originalElement.folders,'folder')&&_.isObject(result.data.originalElement.folders.folder))result.data=[result.data.originalElement.folders.folder];}getFolderCounts=result.data.length;}_.forEach(result.data,function(res){$scope.data.list[res.uuid||res.id]={id:res.uuid||res.id,uuid:res.uuid||res.id,name:$scope.func.getNameFromPath(res.path),permissions:res.permissions,path:res.path,hasChildrenFolder:res.hasChildren,type:'folder',thumbnailSrc:"../../../../static/image/folder.png"};});_.defer(function(){return $scope.$apply();});if(result.data.length<$scope.data.Folder.limit)$scope.func.getChilds();}$scope.data.isRunScrollFunc=false;case 4:case'end':return _context39.stop();}}},_callee39,_this);}));return function(_x37){return _ref38.apply(this,arguments);};}(),function(error){$scope.data.isRunScrollFunc=false;toaster.pop("error","","مشکلی در دریافت پوشه های به وجود آمده است.‌");});}else if($scope.data.File.remaind>0){//sectionChild
service.document.sectionChild($scope.data.currentFileOrFolder.uuid,$scope.data.File.offset,$scope.data.File.limit).then(function(){var _ref39=_asyncToGenerator(regeneratorRuntime.mark(function _callee40(res){var getFileCounts;return regeneratorRuntime.wrap(function _callee40$(_context40){while(1){switch(_context40.prev=_context40.next){case 0:$scope.data.File.offset+=$scope.data.File.limit;$scope.data.File.remaind-=$scope.data.File.limit;if(!(res.data!=null)){_context40.next=11;break;}getFileCounts=0;_context40.next=6;return JS.addJS('ecma5/ExternalLiberary/Public/getSrcFromType.js?dev='+randomVersionName);case 6:$scope.data.removeExternalFuncs['ecma5/ExternalLiberary/Public/getSrcFromType.js?dev='+randomVersionName]='getSrcFromType';getFileCounts=res.data.length;_.forEach(res.data,function(v){v.name=$scope.func.getNameFromPath(v.path);v.type='document';v.mimeType=v.mimeType=='application/octet-stream'?$scope.func.getNameFromPath(v.name.split('.').pop()):v.mimeType;v.selected=false;v.thumbnailSrc=getSrcFromType(v.mimeType);v.notTumbnail=true;$scope.data.list[v.uuid||v.id]=angular.copy(v);$scope.func.getImage(v.uuid||v.id);});_.defer(function(){return $scope.$apply();});if(res.data.length<$scope.data.File.limit&&$scope.data.File.remaind>0)$scope.func.getChilds();case 11:$scope.data.isRunScrollFunc=false;case 12:case'end':return _context40.stop();}}},_callee40,_this);}));return function(_x38){return _ref39.apply(this,arguments);};}(),function(err){$scope.data.isRunScrollFunc=false;toaster.pop("error","","مشکلی در دریافت مستندات به وجود آمده است.‌");});}else $scope.data.isRunScrollFunc=false;}catch(e){$scope.data.isRunScrollFunc=false;console.error(e);}};$scope.func.generatdocument=function(){var _ref40=_asyncToGenerator(regeneratorRuntime.mark(function _callee41(document,doing){var i;return regeneratorRuntime.wrap(function _callee41$(_context41){while(1){switch(_context41.prev=_context41.next){case 0:_context41.prev=0;_context41.next=3;return JS.addJS('ecma5/ExternalLiberary/Search/miladiToJalaliFunction.js?dev='+randomVersionName);case 3:$scope.data.removeExternalFuncs['ecma5/ExternalLiberary/Search/miladiToJalaliFunction.js?dev='+randomVersionName]='miladiToJalaliFunction';_context41.next=6;return miladiToJalaliFunction(document.created);case 6:document.jalaliCreate=_context41.sent;_context41.next=9;return miladiToJalaliFunction(document.lastModified);case 9:document.jalaliLastModified=_context41.sent;document.keywords=_.has(document,'keywords')?_.isArray(document.keywords)?document.keywords:[document.keywords]:[];document.notes=_.has(document,'notes')?_.isArray(document.notes)?document.notes:[document.notes]:[];i=0;case 13:if(!(i<document.notes.length)){_context41.next=20;break;}_context41.next=16;return miladiToJalaliFunction(document.notes[i].date);case 16:document.notes[i].jalaliDate=_context41.sent;case 17:i++;_context41.next=13;break;case 20:_context41.next=22;return JS.addJS('ecma5/ExternalLiberary/Public/getNameFromPath.js?dev='+randomVersionName);case 22:$scope.data.removeExternalFuncs['ecma5/ExternalLiberary/Public/getNameFromPath.js?dev='+randomVersionName]='getNameFromPath';document.label=getNameFromPath(document.path);document.subscribed=_.has(document,'subscribed')?document.subscribed:false;_context41.next=27;return JS.addJS('ecma5/ExternalLiberary/Public/getPermisionArray.js?dev='+randomVersionName);case 27:$scope.data.removeExternalFuncs['ecma5/ExternalLiberary/Public/getPermisionArray.js?dev='+randomVersionName]='getPermisionArray';document.permisionArray=getPermisionArray(document.permissions);document.type='document';try{document.status=_.has(document,'lockInfo')?' '+document.lockInfo.owner+' قفل شده توسط  ':'در دسترس';}catch(e){document.status='در دسترس';}$scope.data.currentFileOrFolder=angular.copy(document);$scope.func.run(doing);_context41.next=39;break;case 35:_context41.prev=35;_context41.t0=_context41['catch'](0);toaster.pop("error","","مشکلی در دریافت آیتم انتخابی به وجود آمده است");console.error(_context41.t0||_context41.t0.message);case 39:_context41.prev=39;_.defer(function(){return $scope.$apply();});return _context41.finish(39);case 42:case'end':return _context41.stop();}}},_callee41,_this,[[0,35,39,42]]);}));return function(_x39,_x40){return _ref40.apply(this,arguments);};}();$scope.func.generatfolder=function(){var _ref41=_asyncToGenerator(regeneratorRuntime.mark(function _callee42(folder,doing){var i;return regeneratorRuntime.wrap(function _callee42$(_context42){while(1){switch(_context42.prev=_context42.next){case 0:_context42.prev=0;_context42.next=3;return JS.addJS('ecma5/ExternalLiberary/Search/miladiToJalaliFunction.js?dev='+randomVersionName);case 3:$scope.data.removeExternalFuncs['ecma5/ExternalLiberary/Search/miladiToJalaliFunction.js?dev='+randomVersionName]='miladiToJalaliFunction';_context42.next=6;return miladiToJalaliFunction(folder.created);case 6:folder.jalaliCreate=_context42.sent;folder.keywords=_.has(folder,'keywords')?_.isArray(folder.keywords)?folder.keywords:[folder.keywords]:[];folder.notes=_.has(folder,'notes')?_.isArray(folder.notes)?folder.notes:[folder.notes]:[];i=0;case 10:if(!(i<folder.notes.length)){_context42.next=17;break;}_context42.next=13;return miladiToJalaliFunction(folder.notes[i].date);case 13:folder.notes[i].jalaliDate=_context42.sent;case 14:i++;_context42.next=10;break;case 17:_context42.next=19;return JS.addJS('ecma5/ExternalLiberary/Public/getNameFromPath.js?dev='+randomVersionName);case 19:$scope.data.removeExternalFuncs['ecma5/ExternalLiberary/Public/getNameFromPath.js?dev='+randomVersionName]='getNameFromPath';folder.label=getNameFromPath(folder.path);folder.subscribed=_.has(folder,'subscribed')?folder.subscribed:false;_context42.next=24;return JS.addJS('ecma5/ExternalLiberary/Public/getPermisionArray.js?dev='+randomVersionName);case 24:$scope.data.removeExternalFuncs['ecma5/ExternalLiberary/Public/getPermisionArray.js?dev='+randomVersionName]='getPermisionArray';folder.permisionArray=getPermisionArray(folder.permissions);try{folder.status=_.has(folder,'lockInfo')?' '+folder.lockInfo.owner+' قفل شده توسط  ':'در دسترس';}catch(e){folder.status='در دسترس';}folder.type='folder';$scope.data.currentFileOrFolder=angular.copy(folder);$scope.func.run(doing);_context42.next=36;break;case 32:_context42.prev=32;_context42.t0=_context42['catch'](0);toaster.pop("error","","مشکلی در دریافت آیتم انتخابی به وجود آمده است");console.error(_context42.t0||_context42.t0.message);case 36:_context42.prev=36;_.defer(function(){return $scope.$apply();});return _context42.finish(36);case 39:case'end':return _context42.stop();}}},_callee42,_this,[[0,32,36,39]]);}));return function(_x41,_x42){return _ref41.apply(this,arguments);};}();$scope.func.getActivatedItem=function(){var _ref42=_asyncToGenerator(regeneratorRuntime.mark(function _callee44(item,doing){return regeneratorRuntime.wrap(function _callee44$(_context44){while(1){switch(_context44.prev=_context44.next){case 0:try{console.log(item);service[item.type].getProperties(item.uuid).then(function(){var _ref43=_asyncToGenerator(regeneratorRuntime.mark(function _callee43(result){return regeneratorRuntime.wrap(function _callee43$(_context43){while(1){switch(_context43.prev=_context43.next){case 0:try{result=_.clone(result.data.originalElement[item.type]);if(_.has(doing,'firstTime')&&item.type=="document"){service.folder.getProperties(result.path.replace(/\/[^\/]+$/,"")).then(function(res){try{res=_.clone(res.data.originalElement.folder);$scope.data.breadcrumbList=[{label:res.path.split("/").pop(),uuid:res.uuid,type:"folder"}];$scope.func['generat'+item.type](angular.copy(result),doing);}catch(e){toaster.pop("error","","مشکلی در دریافت آیتم انتخابی به وجود آمده است");console.error(e||e.message);$uibModalInstance.close(true);}},function(err){toaster.pop("error","","مشکلی در دریافت آیتم انتخابی به وجود آمده است");console.error(e||e.message);$uibModalInstance.close(true);});}else $scope.func['generat'+item.type](angular.copy(result),doing);}catch(e){toaster.pop("error","","مشکلی در دریافت آیتم انتخابی به وجود آمده است");console.error(e||e.message);$uibModalInstance.close(true);}case 1:case'end':return _context43.stop();}}},_callee43,_this);}));return function(_x45){return _ref43.apply(this,arguments);};}(),function(error){toaster.pop("error","","مشکلی در دریافت آیتم انتخابی به وجود آمده است");console.error(error||error.message);$uibModalInstance.close(true);});}catch(e){toaster.pop("error","","مشکلی در دریافت آیتم انتخابی به وجود آمده است");console.error(e||e.message);$uibModalInstance.close(true);}case 1:case'end':return _context44.stop();}}},_callee44,_this);}));return function(_x43,_x44){return _ref42.apply(this,arguments);};}();$scope.func.getActivatedItem(selectItem,{firstTime:true,index:0});$scope.$on("$destroy",_asyncToGenerator(regeneratorRuntime.mark(function _callee47(){return regeneratorRuntime.wrap(function _callee47$(_context47){while(1){switch(_context47.prev=_context47.next){case 0:_context47.prev=0;_context47.prev=1;_context47.next=4;return $scope.func.stopAllOldTasks();case 4:_context47.next=9;break;case 6:_context47.prev=6;_context47.t0=_context47['catch'](1);console.error(_context47.t0);case 9:window.clearAllIntervals();_.forEach(_.clone($scope.data.removeExternalCSS),function(){var _ref45=_asyncToGenerator(regeneratorRuntime.mark(function _callee45(value,src){return regeneratorRuntime.wrap(function _callee45$(_context45){while(1){switch(_context45.prev=_context45.next){case 0:_context45.prev=0;_context45.next=3;return CSS.removeCSS(src);case 3:_context45.next=8;break;case 5:_context45.prev=5;_context45.t0=_context45['catch'](0);console.error(_context45.t0);case 8:case'end':return _context45.stop();}}},_callee45,_this,[[0,5]]);}));return function(_x46,_x47){return _ref45.apply(this,arguments);};}());_.forEach(_.clone($scope.data.removeExternalFuncs),function(){var _ref46=_asyncToGenerator(regeneratorRuntime.mark(function _callee46(funcName,src){return regeneratorRuntime.wrap(function _callee46$(_context46){while(1){switch(_context46.prev=_context46.next){case 0:_context46.prev=0;_context46.next=3;return JS.removeJS(src,funcName);case 3:_context46.next=8;break;case 5:_context46.prev=5;_context46.t0=_context46['catch'](0);console.error(_context46.t0);case 8:case'end':return _context46.stop();}}},_callee46,_this,[[0,5]]);}));return function(_x48,_x49){return _ref46.apply(this,arguments);};}());// clear all data and functions
$scope.func=undefined;$scope.data=undefined;_context47.next=19;break;case 16:_context47.prev=16;_context47.t1=_context47['catch'](0);console.error(_context47.t1);case 19:case'end':return _context47.stop();}}},_callee47,_this,[[0,16],[1,6]]);})));},size:'lg',backdrop:'static',// false,
keyboard:false,resolve:{JS:function JS(){return _JS;},CSS:function CSS(){return _CSS;},service:function service(){return _service;},selectItem:function selectItem(){return _selectItem;},profile:function profile(){return _profile;},uibModal:function uibModal(){return _uibModal;}}});modalInstance.result.then(function(response){return resolve();},function(error){return reject('عدم ساخت پوشه جدید');});});};